<style>body{margin:0;text-align:center;background:#000;touch-action:none}canvas{image-rendering:-moz-crisp-edges;image-rendering:pixelated}</style><canvas id="c"></canvas><script>!function(){function n(n,e,t){return n>t?t:e>n?e:n}function e(n,e){return Math.floor(Math.random()*(e+1-n)+n)}function t(n){return n[e(0,n.length-1)]}var i=songs={konamiCode:{songData:[{i:[0,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,11,6],p:[1],c:[{n:[146,149,154,158,154],f:[]}]}],rowLen:5513,patternLen:32,endPattern:0,numChannels:1},markSparlingSong:{songData:[{i:[2,104,128,0,3,234,128,0,0,0,0,20,35,0,0,0,195,6,1,2,183,152,0,49,147,4,103,4],p:[1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2],c:[{n:[135,,,,142,,,,143,,,,147,,,,135,,,,142,,,,143,,,,147],f:[21,,,,,,21,,,21,,21,21,,21,21,,21,21,,21,21,21,21,21,21,21,21,21,21,21,21,15,,,,,,15,,,17,,18,20,,21,24,,25,27,,30,31,33,37,40,43,45,51,53,55,58,60]},{n:[135,,,,142,,,,143,,,,147,,,,150,,,,154,,,,155,,,,159],f:[21,,,,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,,21,,21,,,63,,,,71,82,89,92,96,99,102,107,111,115,120,127,131,135,141,145,149,155,159,164,168,172,,177,,183]}]},{i:[2,208,128,0,2,201,128,1,0,0,0,148,67,0,0,0,16,0,1,2,0,120,53,33,17,4,84,6],p:[,,3,4,3,4,3,4,3,4,3,4,3,4,3,4,9,10,36,4,3,4,3,4,3,4,3,4,3,4],c:[{n:[],f:[]},{n:[],f:[]},{n:[111],f:[21,21,21,,21,21,21,,21,,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,,21,21,21,21,1,2,2,,3,2,4,,5,,6,6,6,7,8,7,8,10,13,15,17,20,22,24,26,28,31,,35,40,46,48]},{n:[111],f:[21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,48,63,59,69,77,88,96,102,113,131,143,157,168,186,195,120,107,92,82,71,60,46,39,30,19,11,5,4,2,1]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[119],f:[21,21,21,,21,21,21,,21,,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,,21,21,21,21,1,2,2,,3,2,4,,5,,6,6,6,7,8,7,8,10,13,15,17,20,22,24,26,28,31,,35,40,46,48]},{n:[119],f:[21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,48,63,59,69,77,88,96,102,113,131,143,157,168,186,195,120,107,92,82,71,60,46,39,30,19,11,5,4,2,1]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[148],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[119,,,,,,,,,,,,,,,,121],f:[21,21,21,,21,21,21,,21,,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,,21,21,21,21,1,2,2,,3,2,4,,5,,6,6,6,7,8,7,8,10,13,15,17,20,22,24,26,28,31,,35,40,46,48]}]},{i:[2,75,128,0,2,84,128,8,0,0,12,186,61,0,0,0,0,0,0,2,0,77,0,32,83,3,130,4],p:[,,5,6,5,6,5,6,5,6,5,6,5,6,5,6,7,8,34,6,5,6,5,6,5,6,5,6,5,6],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[99],f:[21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,,21,21,21,21,21,21,21,21,21,21,,2,4,6,9,14,20,26,31,38,46,48,51,53,55,59,69,71,74,77,80,,88,99,106,113,122,135,139,147,153,157]},{n:[99],f:[21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,242,237,232,214,200,183,164,155,145,131,120,102,86,71,63,57,,52,48,44,36,30,23,17,13,10,6,4,2,1,1]},{n:[107],f:[21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,,21,21,21,21,21,21,21,21,21,21,,2,4,6,9,14,20,26,31,38,46,48,51,53,55,59,69,71,74,77,80,,88,99,106,113,122,135,139,147,153,157]},{n:[107],f:[21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,242,237,232,214,200,183,164,155,145,131,120,102,86,71,63,57,,52,48,44,36,30,23,17,13,10,6,4,2,1,1]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[107,,,,,,,,,,,,,,,,109],f:[21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,,21,21,21,21,21,21,21,21,21,21,,2,4,6,9,14,20,26,31,38,46,48,51,53,55,59,69,71,74,77,80,,88,99,106,113,122,135,139,147,153,157]}]},{i:[0,57,128,0,3,57,128,0,0,0,5,6,77,0,0,0,195,6,1,2,19,0,0,32,255,6,207,1],p:[,,,,28,30,28,30,28,30,28,30,28,30,28,30,28,30,28,30,28,30,28,30,28,30,28,30],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[135,,,,,,,,,,,,,,,,,,,,,,,,135,,,,,,,,138,,,,,,,,,,,,,,,,,,,,,,,,138,,,,,,,,142,,,,,,,,,,,,,,,,,,,,,,,,143,,,,,,,,123,,,,,,,,,,,,,,,,,,,,,,,,123],f:[]},{n:[],f:[]},{n:[135,,,,,,,,,,,,,,,,,,,,,,,,135,,,,,,,,138,,,,,,,,,,,,,,,,,,,,,,,,138,,,,,,,,142,,,,,,,,,,,,,,,,,,,,,,,,140,,,,,,,,123,,,,,,,,,,,,,,,,,,,,,,,,123],f:[]}]},{i:[2,0,128,0,2,201,128,0,0,0,15,6,20,0,0,0,93,4,1,3,70,199,10,32,130,2,33,6],p:[,,,,,,,,,,,,,,,,13,13,13,13,13,13,13,13],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[155,154,150,147,155,154,150,147,155,154,150,147,155,154,150,147,155,154,150,147,155,154,150,147,155,154,150,147,155,154,150,147],f:[]}]},{i:[0,160,128,1,0,160,128,0,1,210,4,7,41,0,0,0,60,4,1,2,255,0,0,32,61,5,32,6],p:[,,,,,,,,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[,,,,,,,,135,,,,,,,,,,,,,,,,135],f:[]}]},{i:[0,255,116,1,0,255,116,0,1,0,4,6,35,0,0,0,0,0,0,2,14,0,0,32,0,0,0,0],p:[,,,,,,,,27,15,27,15,27,15,27,15,27,15,27,15,27,15,27,15],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[135,,,,,,,,,,,,,,,,135,,135,,,,135],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[135,,,,,,,,,,,,,,,,135,,,,135],f:[]}]},{i:[2,117,128,0,1,92,128,2,0,19,17,20,68,0,0,0,51,2,1,2,232,112,0,32,171,3,81,4],p:[,,,,,,,,,,,,35,31,19,25,35,31,19,25],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[150,,,,,,,,152,,,,,,,,149,,,,,,,,145,,,,,,,,147,,,,,,,,147,,,,,,,,142,,,,,,,,142],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[154,,,,,,,,154,,,,,,,,154,,,,,,,,154,,,,,,,,147,,,,,,,,147,,,,,,,,145,,,,,,,,145],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[154,,,,,,,,154,,,,,,,,147,,,,,,,,149,,,,,,,,147,,,,,,,,147,,,,,,,,142,,,,,,,,142],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[147,,,,,,,,147,,,,,,,,147,,,,,,,,147,,,,,,,,154,,,,,,,,154,,,,,,,,152,,,,,,,,152],f:[]}]}],rowLen:4410,patternLen:32,endPattern:29,numChannels:8}},o=CPlayer=function(){var n,e,t,i,o,r=n=>Math.sin(6.283184*n),a=n=>.003959503758*Math.pow(2,(n-128)/12),s=(n,e,t)=>{var i,o,r,s,l,h,c,d=f[n.i[0]],g=n.i[1],w=n.i[3],u=f[n.i[4]],p=n.i[5],y=n.i[8],b=n.i[9],m=n.i[10]*n.i[10]*4,k=n.i[11]*n.i[11]*4,A=n.i[12]*n.i[12]*4,v=1/A,T=n.i[13],P=t*Math.pow(2,2-n.i[14]),M=new Int32Array(m+k+A),x=0,S=0;for(i=0,o=0;m+k+A>i;i++,o++)0>o||(o-=P,h=a(e+(15&(T=T>>8|(255&T)<<4))+n.i[2]-128),c=a(e+(15&T)+n.i[6]-128)*(1+8e-4*n.i[7])),r=1,m>i?r=i/m:m+k>i||(r-=(i-m-k)*v),s=h,w&&(s*=r*r),l=d(x+=s)*g,s=c,y&&(s*=r*r),l+=u(S+=s)*p,b&&(l+=(2*Math.random()-1)*b),M[i]=80*l*r|0;return M},f=[r,n=>.5>n%1?1:-1,n=>n%1*2-1,n=>{var e=n%1*4;return 2>e?e-1:3-e}];this.init=(r=>{n=r,e=r.endPattern,t=0,i=r.rowLen*r.patternLen*(e+1)*2,o=new Int32Array(i)}),this.generate=(()=>{var a,l,h,c,d,g,w,u,p,y,b,m,k,A,v=new Int32Array(i),T=n.songData[t],P=n.rowLen,M=n.patternLen,x=0,S=0,C=!1,I=[];for(h=0;e>=h;++h)for(w=T.p[h],c=0;M>c;++c){var E=w?T.c[w-1].f[c]:0;E&&(T.i[E-1]=T.c[w-1].f[c+M]||0,16>E&&(I=[]));var B=f[T.i[15]],D=T.i[16]/512,R=Math.pow(2,T.i[17]-9)/P,L=T.i[18],U=T.i[19],F=135.82764118168*T.i[20]/44100,W=1-T.i[21]/255,K=1e-5*T.i[22],H=T.i[23]/32,O=T.i[24]/512,j=6.283184*Math.pow(2,T.i[25]-9)/P,V=T.i[26]/255,Z=T.i[27]*P&-2;for(b=(h*M+c)*P,d=0;4>d;++d)if(g=w?T.c[w-1].n[c+d*M]:0){I[g]||(I[g]=s(T,g,P));var z=I[g];for(l=0,a=2*b;l<z.length;l++,a+=2)v[a]+=z[l]}for(l=0;P>l;l++)(y=v[u=2*(b+l)])||C?(m=F,L&&(m*=B(R*u)*D+.5),S+=(m=1.5*Math.sin(m))*(k=W*(y-S)-(x+=m*S)),y=3==U?S:1==U?k:x,K&&(y=1>(y*=K)?y>-1?r(.25*y):-1:1,y/=K),C=(y*=H)*y>1e-5,A=y*(1-(p=Math.sin(j*u)*O+.5)),y*=p):A=0,Z>u||(A+=v[u-Z+1]*V,y+=v[u-Z]*V),v[u]=0|A,v[u+1]=0|y,o[u]+=0|A,o[u+1]+=0|y}return++t/n.numChannels}),this.createWave=(()=>{var n=44+2*i-8,e=n-36,t=new Uint8Array(44+2*i);t.set([82,73,70,70,255&n,n>>8&255,n>>16&255,n>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&e,e>>8&255,e>>16&255,e>>24&255]);for(var r=0,a=44;i>r;++r){var s=o[r];s=-32767>s?-32767:s>32767?32767:s,t[a++]=255&s,t[a++]=s>>8&255}return t}),this.getData=((n,e)=>{for(var t=2*Math.floor(44100*n),i=Array(e),r=0;2*e>r;r+=1){var a=t+r;i[r]=n>0&&a<o.length?o[a]/32768:0}return i})};const r=[38,38,40,40,37,39,37,39,66,65];let a=0;const s=0,f=1,l=2,h=3,d=4;let g,w,u,p,y,b,m=s,k=!1,A=!1,v=0,T=[],P=0,M={play:()=>{}},x={play:()=>{}};const S=180/Math.PI;function C(){this.left=0,this.right=0,this.up=0,this.down=0}function I(n,e){this.type=n,this.target=e,this.nextChange=.5,this.remaining=0}function E(n,e=0,t=0,i=0){this.speed=n,this.dx=e,this.dy=t,this.dr=i}function B(n,e,t=0){this.x=n,this.y=e,this.r=t}function D(n,e,t){this.collide=n,this.killable=e,this.foe=t}function R(n){this.timeLeft=n}function L(n,e,t,i){this.alwaysRender=n,this.renderer=e,this.radarRenderer=t,this.debrisRenderer=i}const U=c.getContext("2d"),F=c.cloneNode(),W=F.getContext("2d"),K=c.cloneNode(),H=K.getContext("2d"),O={},j=8;for(let n=0;43>n;n++)O["abcdefghijklmnopqrstuvwxyz0123456789.:!-%,/"[n]]=n*j;const V=0,Z=1,z=2,Q=.1;let J,X,Y,q,N="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAVgAAAAIAgMAAADB+w+QAAAADFBMVEUAAAARCgP///8AAADe3w1AAAAAAXRSTlMAQObYZgAAAUlJREFUKM9VUjFuwzAMpAf5BVGB+jVeuquA6CFzUYDqZzzEQ3Z5ENr+sXeiE6MiJNFH8kTSFFXNMWtSrJhz1K7oTDgkTX2rL2L0CCkgApKp9+8kWDwvEUqU0rpUv836bWUuZjbVUvum5Vj0mIhCrEJf/Zu04yryYVBMEOBE23/afrZTHpS+mcbSbEfUrduayDCPa8zvbZiHJt1l6xSbaWkvtwgS0p4Zeij3tMOjFsQsrUC/wkvb9bcYcx3XqY4Vd2UTntlaI62xJWr3BxWwtvRaPu9ThdxAt1/3xatoQ7WvghwpsJJ8FQ/0bIuXeTxk3vOdBY/sIG5qHkFZdvoB+V6AU2Iub8NaZjlcGOIB1HH6L7M0EavIgLTQzweAMnfaflg6RcRex9lEcnwOWPIBi0lxHgMmAQDHLGjodh8o2oFm4Id4E8B3CZLlD7GmBBrI7F8nAAAAAElFTkSuQmCC",$=0,G=!0;function _(){b=0,w=en("player",{collision:new D(!0,a!==r.length,!1),input:new C,position:new B(200,F.height-200),velocity:new E(40),sprite:new L(!0,cn,yn,()=>wn("rgb(75,190,250)"))});const n=g[v];p=[...n.looseCondition,w],y=n.winCondition,u=[...n.otherEntities,...p,...y],m=h}function nn(){A=k=!1,v<g.length?m=l:(a=0,m=f)}function en(n,e){return{...e,echo:{...e.position},online:!0,radius:6,type:n}}function tn({x:n,y:e},{x:t,y:i},o){return Math.pow(o,2)>Math.pow(n-t,2)+Math.pow(e-i,2)}function on(n){if(n.collision.killable){n.dead=!0,n!==w&&"torpedo"!==n.type&&P++;const{position:{x:t,y:i},velocity:{dx:o,dy:r,speed:a}}=n,s=new D(!1,!1),f=new L(!0,n.sprite.debrisRenderer);[1,2,3].forEach(n=>{const l=new B(t,i),h=new E(a,o/2+e(-2,2)/10,r/2+e(-2,2)/10,e(1,n+1)*(n%2?1:-1)),c=new R(e(20,50)/10);T.push(en("debris",{collision:s,position:l,sprite:f,ttl:c,velocity:h}))})}}function rn({position:n,velocity:e},{echo:t}){return(({x:n,y:e},{x:t,y:i})=>((Math.atan2(i,t)-Math.atan2(e,n))*S+180)%360-180)({x:e.dx,y:e.dy},{x:t.x-n.x,y:t.y-n.y})}function an({r:n},e){return Math.sin(-n/S)*e}function sn({r:n},e){return Math.cos(-n/S)*e}function fn(n,e){console.log(`loading ${e}...`);const t=new o;t.init(n);let i=0;for(;1>i;)i=t.generate(),console.log(`loaded ${100*i}%`);let r=t.createWave();return[document.createElement("audio"),URL.createObjectURL(new Blob([r],{type:"audio/wav"}))]}function ln(){W.fillStyle=W.createPattern(K,"repeat"),W.fillRect(0,0,F.width,F.height)}function hn({echo:n,sprite:e}){W.save(),W.translate(Math.round(n.x),Math.round(n.y)),W.rotate(n.r/S),e.renderer(),W.restore()}function cn(){W.shadowBlur=10,W.fillStyle="rgb(75,190,250)",W.shadowColor=W.fillStyle,W.beginPath(),W.arc(0,0,5,0,2*Math.PI),W.fillRect(-2,-12,4,12),W.fill(),W.closePath()}function dn(){W.shadowBlur=10,W.strokeStyle=w.online?"rgb(220,240,150)":"rgb(80,100,80)",W.lineWidth=3,W.shadowColor=W.strokeStyle,W.beginPath(),W.moveTo(0,-6),W.lineTo(0,2),W.stroke(),W.moveTo(0,4),W.lineTo(0,6),W.stroke(),W.closePath()}function gn(){W.beginPath(),W.shadowBlur=10,W.fillStyle=w.online?"rgb(230,90,100)":"rgb(55,40,35)",W.shadowColor=W.fillStyle,W.fillRect(-5,-5,10,10),W.fillRect(-2,-12,4,12),W.fill(),W.closePath()}function wn(n){W.beginPath(),W.shadowBlur=10,W.fillStyle=n,W.shadowColor=W.fillStyle,W.moveTo(-5,-10),W.lineTo(5,0),W.lineTo(-4,-2),W.fill(),W.closePath()}function un(n){const{echo:e,sprite:t}=n;t.radarRenderer&&(W.save(),W.translate(Math.round(e.x),Math.round(e.y)),t.radarRenderer(n),W.restore())}function pn({echo:n}){W.rotate(n.r/S),W.shadowBlur=10,W.strokeStyle=w.online?"rgb(220,240,150)":"rgb(80,100,80)",W.shadowColor=W.strokeStyle,W.fillStyle=w.online?"rgba(80,100,80,0.15)":"rgba(80,100,80,0.25)",W.beginPath(),W.moveTo(-4,0),W.arc(0,0,200,5*-Math.PI/8,3*-Math.PI/8),W.lineTo(4,0),W.fill(),W.stroke(),W.closePath()}function yn(n){const{dashOffset:e=0,dashTime:t=0}=n;W.shadowBlur=10,W.strokeStyle="rgb(70,105,105)",W.shadowColor=W.strokeStyle,W.beginPath(),W.arc(0,0,100,0,2*Math.PI),W.stroke(),W.closePath(),W.beginPath(),W.lineDashOffset=e,W.setLineDash([4,8]),W.arc(0,0,40,0,2*Math.PI),W.stroke(),W.closePath(),n.dashTime=t+X,n.dashTime>Q&&(n.dashTime-=Q,n.dashOffset=(e-1)%12)}function bn(){W.shadowBlur=10,W.strokeStyle="rgb(55,40,35)",W.shadowColor=W.strokeStyle,W.beginPath(),W.arc(0,0,80,0,2*Math.PI),W.stroke(),W.closePath()}function mn(n,e,t,i=V,o=1){const r=o*j,a=n.length*r,s=i===z?a:i===Z?a/2:0;[...n].forEach((n,i)=>{n in O&&W.drawImage(N,O[n],0,j,j,e+i*r-s,t,r,r)})}function kn(){G&&(q=requestAnimationFrame(kn),(()=>{switch(W.fillStyle="rgb(20,35,40)",W.fillRect(0,0,F.width,F.height),m){case s:mn(`loading${.25>$?"":.5>$?".":.75>$?"..":"..."}`,F.width/2,F.height/2,Z);break;case f:ln(),W.save(),W.shadowBlur=10,W.strokeStyle="rgb(70,105,105)",W.shadowColor=W.strokeStyle,W.fillStyle="rgba(30,60,60,0.5)",W.translate(F.width/2-100,100),W.save(),W.scale(.8,.8),W.rotate(35/S),W.beginPath(),W.moveTo(0,10),W.arc(0,10,20,1.5*Math.PI,.5*Math.PI),W.arc(0,-10,20,.5*Math.PI,1.5*Math.PI),W.closePath(),W.fill(),W.stroke(),W.moveTo(0,0),W.restore(),W.translate(38,0),W.beginPath(),W.arc(0,5,15,2*Math.PI,Math.PI),W.moveTo(15,5),W.lineTo(15,-20),W.lineTo(-15,-20),W.lineTo(-15,5),W.fill(),W.stroke(),W.closePath(),W.moveTo(0,0),W.translate(40,0),W.beginPath(),W.arc(0,-10,10,1.5*Math.PI,.5*Math.PI),W.moveTo(0,-20),W.lineTo(-15,-20),W.lineTo(-15,20),W.lineTo(0,20),W.moveTo(0,0),W.arc(0,10,10,1.5*Math.PI,.5*Math.PI),W.fill(),W.stroke(),W.closePath(),W.moveTo(0,0),W.translate(40,0),W.beginPath(),W.moveTo(0,0),W.lineTo(7.5,20),W.lineTo(22.5,-20),W.lineTo(-22.5,-20),W.lineTo(-7.5,20),W.lineTo(7.5,-20),W.fill(),W.stroke(),W.closePath(),W.translate(35,0),W.moveTo(0,0),W.beginPath(),W.lineTo(0,-20),W.lineTo(-15,20),W.lineTo(15,20),W.lineTo(0,-20),W.fill(),W.stroke(),W.closePath(),W.translate(40,0),W.beginPath(),W.arc(0,-10,10,1.5*Math.PI,.5*Math.PI),W.moveTo(0,-20),W.lineTo(-15,-20),W.lineTo(-15,20),W.lineTo(10,20),W.lineTo(0,0),W.fill(),W.stroke(),W.closePath(),W.moveTo(0,0),W.translate(-100,70),W.font="54px Arial",W.textAlign="center",W.textBase="bottom",W.fillText("2063",0,0),W.strokeText("2063",0,0),W.restore(),$>.4&&mn("press any key to start",F.width/2,.75*F.height,Z);break;case l:mn(`mission #0${v+1}`,F.width/2,F.height/2,Z),mn(g[v].description,F.width/2,F.height/2+2*j,Z),$>.4&&mn("press any key to start mission",F.width/2,.75*F.height,Z);break;case h:ln(),u.forEach(un),u.forEach(hn),mn(`sonar: ${w.online?"on":"off"}line`,j,j);break;case d:v<g.length?A?(mn(`mission 0${v} completed!`,F.width/2,F.height/2,Z),$>.4&&mn("press any key to start next mission",F.width/2,.75*F.height,Z)):(mn("you died!",F.width/2,F.height/2,Z),$>.4&&mn("press any key to try again",F.width/2,.75*F.height,Z)):(mn("you finished submersible warship 2063",F.width/2,F.height/2,Z),mn("thank you for playing!",F.width/2,F.height/2+2*j,Z),mn("press t to tweet your score",F.width/2,.75*F.height,Z))}U.drawImage(F,0,0,F.width,F.height,0,0,c.width,c.height)})(),J=Date.now(),($+=X=(J-Y)/1e3)>1&&($-=1),(()=>{switch(m){case h:u.forEach(e=>{(n=>{const{strategy:e,position:t,collision:{foe:i}}=n;if(e)switch(e.type){case"lockon":const{echo:o,online:r,dead:a}=e.target;(a||!r&&tn(t,o,10))&&(n.strategy={...e,type:"cruise",target:void 0,nextChange:.5,remaining:0},n.input=null,n.velocity.dr=0);break;case"cruise":u.filter(({collision:n})=>!!n.foe&&n.foe!==i).forEach(i=>{const{echo:o}=i;tn(t,o,180)&&22.5>Math.abs(rn(n,i))&&(n.strategy={...e,type:"lockon",target:i,nextChange:.1,remaining:0},e.target=i,n.input=new C)})}})(e),(n=>{const{input:e,strategy:i}=n;if(i&&(i.remaining-=X,0>i.remaining))switch(i.remaining+=i.nextChange,i.type){case"lockon":const o=rn(n,i.target);e.left=-5>o?-1:0,e.right=o>5?1:0,e.up=-1,e.down=0;break;case"random":e.up=t([-1,0]),e.left=t([-1,0]),e.right=t([1,0]),e.down=t([1,0])}})(e),(({input:n,position:e,velocity:t})=>{n&&(t.dr=n.left+n.right,t.dx=an(e,n.up+n.down),t.dy=sn(e,n.up+n.down))})(e),(({velocity:n,position:e})=>{const t=n.speed*X;e.x+=t*n.dx,e.y+=t*n.dy,e.r=(e.r+t*n.dr)%360})(e),(({position:n,echo:e,sprite:t,online:i})=>{(t.alwaysRender||w.online&&i)&&(e.x=n.x,e.y=n.y,e.r=n.r)})(e),(n=>{let{ttl:e}=n;e&&(e.timeLeft-=X,1>e.timeLeft&&(n.dead=!0))})(e),(e=>{const{position:t}=e;t.x=n(t.x,0,F.width-e.radius),t.y=n(t.y,0,F.height-e.radius)})(e)});let e=new Set;u.forEach((n,t)=>{u.slice(t+1).forEach(t=>{((n,e)=>{const{position:t,collision:i}=n,{position:o,collision:r}=e;return i.collide&&r.collide&&tn(t,o,n.radius+e.radius)})(n,t)&&(e.add(n),e.add(t))})}),e.forEach(on),u=u.filter(({dead:n})=>!n),T.length>0&&(T.forEach(n=>u.push(n)),T=[]),k||A?b+=X:(k=p.length===p.filter(({dead:n})=>n).length,A=y.length===y.filter(({dead:n})=>n).length),b>4&&(A&&(v+=1),m=d)}})(),Y=J)}function An(n){(G=n)?(Y=Date.now(),kn()):cancelAnimationFrame(q)}onload=(async n=>{document.title="SUBmersible WARship 2063",onresize(),N=await(n=>new Promise(e=>{let t=new Image;t.onload=(()=>e(t)),t.src=n}))(N),An(!0),setTimeout(()=>{(async()=>{K.width=K.height=64,H.strokeStyle="rgb(40,55,50)",H.beginPath(),H.moveTo(0,4),H.lineTo(8,4),H.stroke(),H.closePath(),H.beginPath(),H.moveTo(4,0),H.lineTo(4,8),H.stroke(),H.closePath()})(),g=[{description:"enemy mine drifted into our perimeter. destroy it.",looseCondition:[],otherEntities:[],winCondition:[en("sub1",{collision:new D(!0,!0,!0),input:new C,position:new B(100,100),velocity:new E(20),strategy:new I("random"),sprite:new L(!1,gn,bn,()=>wn("rgb(230,90,100)"))}),en("sub1",{collision:new D(!0,!0,!0),input:new C,position:new B(100,F.height-100),velocity:new E(20),strategy:new I("random"),sprite:new L(!1,gn,bn,()=>wn("rgb(230,90,100)"))})]},{description:"enemy subs entered our perimeter. sink them all.",looseCondition:[],otherEntities:[],winCondition:[en("sub1",{collision:new D(!0,!0,!0),input:new C,position:new B(100,100),velocity:new E(20),strategy:new I("random"),sprite:new L(!1,gn,bn,()=>wn("rgb(230,90,100)"))}),en("sub1",{collision:new D(!0,!0,!0),input:new C,position:new B(100,F.height-100),velocity:new E(20),strategy:new I("random"),sprite:new L(!1,gn,bn,()=>wn("rgb(230,90,100)"))}),en("sub1",{collision:new D(!0,!0,!0),input:new C,position:new B(F.width-100,100),velocity:new E(20),strategy:new I("random"),sprite:new L(!1,gn,bn,()=>wn("rgb(230,90,100)"))}),en("sub1",{collision:new D(!0,!0,!0),input:new C,position:new B(F.width-100,F.height-100),velocity:new E(20),strategy:new I("random"),sprite:new L(!1,gn,bn,()=>wn("rgb(230,90,100)"))})]}],(async()=>{let[n,e]=fn(i.konamiCode,"secret song");(M=n).src=e,[n,e]=fn(i.markSparlingSong,"Mark Sparling's song"),(x=n).src=e,x.loop=!0})(),x.play(),m=f},100)}),onresize=onrotate=(()=>{c.width=F.width=innerWidth>1.6*innerHeight?1.6*innerHeight:innerWidth,c.height=F.height=innerWidth>1.6*innerHeight?innerHeight:innerWidth/1.6,U.imageSmoothingEnabled=W.imageSmoothingEnabled=!1}),document.onvisibilitychange=(n=>{An(!n.target.hidden)}),onkeydown=(n=>{if(n.preventDefault(),!n.repeat)switch(m){case h:switch(n.code){case"ArrowLeft":case"KeyA":w.input.left=-1;break;case"ArrowUp":case"KeyW":w.input.up=-1;break;case"ArrowRight":case"KeyD":w.input.right=1;break;case"ArrowDown":case"KeyS":w.input.down=1;break;case"Space":w.dead||(({position:n},e)=>{const t=new I("cruise"),i=new D(!0,!0,!1),o=new L(!1,dn,pn,()=>wn("rgb(220,240,150)")),r=new R(30),a=an(n,-1),s=sn(n,-1),f=new B(n.x+20*a,n.y+20*s,n.r),l=new E(60,a,s);T.push(en("torpedo",{collision:i,input:null,position:f,sprite:o,strategy:t,ttl:r,velocity:l}))})(w);break;case"KeyP":An(!G)}}}),onkeyup=(n=>{switch(m){case f:n.which!==r[a]||a===r.length?m=l:++a===r.length&&M.play();break;case l:_();break;case h:switch(n.code){case"ArrowLeft":case"KeyA":w.input.left=0;break;case"ArrowRight":case"KeyD":w.input.right=0;break;case"ArrowUp":case"KeyW":w.input.up=0;break;case"ArrowDown":case"KeyS":w.input.down=0;break;case"KeyO":case"KeyF":w.online=!w.online,w.switchModeTime=J}break;case d:switch(n.code){case"KeyT":open(`https://twitter.com/intent/tweet?text=I%20sunk%20${P||0}%20enemy%20submarines%20in%20SUBmersible%20WARship%202063%20by%20@herebefrogs%20for%20@js13kgames%202018%3A%20https%3A%2F%2Fgoo.gl%2FHLo6Df`,"_blank");break;default:nn()}}});let vn=0,Tn=0,Pn=0,Mn=0;function xn(n){return[n.pageX||n.changedTouches[0].pageX,n.pageY||n.changedTouches[0].pageY]}ontouchstart=onpointerdown=(n=>{switch(n.preventDefault(),m){case h:[Pn,Mn]=[vn,Tn]=xn(n)}}),ontouchmove=onpointermove=(n=>{switch(n.preventDefault(),m){case h:vn&&Tn&&(([n,e])=>{n>Pn?(Pn=n)-vn>44&&(w.input.right=1):vn>n?Pn-(vn=n)>44&&(w.input.left=-1):Pn>n&&w.input.right?(vn=n,w.input.right=0):n>vn&&w.input.left&&(Pn=n,w.input.left=0),e>Mn?(Mn=e)-Tn>44&&(w.input.down=1):Tn>e?Mn-(Tn=e)>44&&(w.input.up=-1):Mn>e&&w.input.down?(Tn=e,w.input.down=0):e>Tn&&w.input.up&&(Mn=e,w.input.up=0)})(xn(n))}}),ontouchend=onpointerup=(n=>{switch(n.preventDefault(),m){case f:m=l;break;case l:_();break;case h:w.input.left=w.input.right=w.input.up=w.input.down=0,vn=Tn=Pn=Mn=0;break;case d:nn()}})}();</script>
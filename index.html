<style>body{margin:0;text-align:center;background:#000;touch-action:none}</style><canvas id="c"></canvas><script>!function(){function e(e,t){return Math.floor(Math.random()*(t+1-e)+e)}function t(t){return t[e(0,t.length-1)]}const n=window,i=document,o=[38,38,40,40,37,39,37,39,66,65];let r=0;const a=0,s=1,h=2;let l,d,u,w,g,p=a,f=0,y=180/Math.PI;function b(){this.left=this.right=this.up=this.down=0}function A(e,t){this.type=e,this.target=t,this.nextChange=2,this.remaining=0}function m(e,t=0,n=0,i=0){this.speed=e,this.dx=t,this.dy=n,this.dr=i}function k(e,t,n=0){this.x=e,this.y=t,this.r=n}function M(e,t,n){this.collide=e,this.killable=t,this.foe=n}function v(e){this.timeLeft=e}function x(e,t,n,i){this.alwaysRender=e,this.renderer=t,this.radarRenderer=n,this.debrisRenderer=i}const P=c.getContext("2d"),S=c.cloneNode(),T=S.getContext("2d"),I=c.cloneNode(),E=I.getContext("2d"),B="abcdefghijklmnopqrstuvwxyz0123456789.:!-%,/",C=0,D=1,R=2,F=8,U=.1;let W,K,H,L,O="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAVgAAAAIAgMAAADB+w+QAAAADFBMVEUAAAARCgP///8AAADe3w1AAAAAAXRSTlMAQObYZgAAAUlJREFUKM9VUjFuwzAMpAf5BVGB+jVeuquA6CFzUYDqZzzEQ3Z5ENr+sXeiE6MiJNFH8kTSFFXNMWtSrJhz1K7oTDgkTX2rL2L0CCkgApKp9+8kWDwvEUqU0rpUv836bWUuZjbVUvum5Vj0mIhCrEJf/Zu04yryYVBMEOBE23/afrZTHpS+mcbSbEfUrduayDCPa8zvbZiHJt1l6xSbaWkvtwgS0p4Zeij3tMOjFsQsrUC/wkvb9bcYcx3XqY4Vd2UTntlaI62xJWr3BxWwtvRaPu9ThdxAt1/3xatoQ7WvghwpsJJ8FQ/0bIuXeTxk3vOdBY/sIG5qHkFZdvoB+V6AU2Iub8NaZjlcGOIB1HH6L7M0EavIgLTQzweAMnfaflg6RcRex9lEcnwOWPIBi0lxHgMmAQDHLGjodh8o2oFm4Id4E8B3CZLlD7GmBBrI7F8nAAAAAElFTkSuQmCC",V=!0;function Z(){g=0,l=j("player",{collision:new M(!0,r!==o.length,!1),input:new b,position:new k(200,S.height-200),velocity:new m(40),sprite:new x(!0,q,te,()=>$("rgb(75,190,250)"))}),u=[l],w=[j("sub1",{collision:new M(!0,!0,!0),input:new b,position:new k(100,100),velocity:new m(20),strategy:new A("random"),sprite:new x(!1,G,ne,()=>$("rgb(230,90,100)"))}),j("sub1",{collision:new M(!0,!0,!0),input:new b,position:new k(100,S.height-100),velocity:new m(20),strategy:new A("random"),sprite:new x(!1,G,ne,()=>$("rgb(230,90,100)"))}),j("sub1",{collision:new M(!0,!0,!0),input:new b,position:new k(S.width-100,100),velocity:new m(20),strategy:new A("random"),sprite:new x(!1,G,ne,()=>$("rgb(230,90,100)"))}),j("sub1",{collision:new M(!0,!0,!0),input:new b,position:new k(S.width-100,S.height-100),velocity:new m(20),strategy:new A("random"),sprite:new x(!1,G,ne,()=>$("rgb(230,90,100)"))})],d=[...u,...w],p=s}function j(e,t){return{...t,echo:{...t.position},online:!0,radius:6,type:e}}function z({x:e,y:t},{x:n,y:i},o){return Math.pow(o,2)>Math.pow(e-n,2)+Math.pow(t-i,2)}function Q(t){if(t.collision.killable){t.dead=!0,t!==l&&"torpedo"!==t.type&&f++;const{position:{x:n,y:i},velocity:{dx:o,dy:r,speed:a}}=t,s=new M(!1,!1),h=new x(!0,t.sprite.debrisRenderer);[1,2,3].forEach(t=>{const l=new k(n,i),c=new m(a,o/2+e(-2,2)/10,r/2+e(-2,2)/10,e(1,t+1)*(t%2?1:-1)),u=new v(e(20,50)/10);d.push(j("debris",{collision:s,position:l,sprite:h,ttl:u,velocity:c}))})}}function J({r:e},t){return Math.sin(-e/y)*t}function X({r:e},t){return Math.cos(-e/y)*t}function Y({echo:e,sprite:t}){T.save(),T.translate(Math.round(e.x),Math.round(e.y)),T.rotate(e.r/y),t.renderer(),T.restore()}function q(){T.shadowBlur=10,T.fillStyle="rgb(75,190,250)",T.shadowColor=T.fillStyle,T.beginPath(),T.arc(0,0,5,0,Math.PI+Math.PI),T.fillRect(-2,-12,4,12),T.fill(),T.closePath()}function N(){T.shadowBlur=10,T.strokeStyle=l.online?"rgb(220,240,150)":"rgb(80,100,80)",T.lineWidth=3,T.shadowColor=T.strokeStyle,T.beginPath(),T.moveTo(0,-6),T.lineTo(0,2),T.stroke(),T.moveTo(0,4),T.lineTo(0,6),T.stroke(),T.closePath()}function G(){T.beginPath(),T.shadowBlur=10,T.fillStyle=l.online?"rgb(230,90,100)":"rgb(55,40,35)",T.shadowColor=T.fillStyle,T.fillRect(-5,-5,10,10),T.fillRect(-2,-12,4,12),T.fill(),T.closePath()}function $(e){T.beginPath(),T.shadowBlur=10,T.fillStyle=e,T.shadowColor=T.fillStyle,T.moveTo(-5,-10),T.lineTo(5,0),T.lineTo(-4,-2),T.fill(),T.closePath()}function _(e){const{echo:t,sprite:n}=e;n.radarRenderer&&(T.save(),T.translate(Math.round(t.x),Math.round(t.y)),n.radarRenderer(e),T.restore())}function ee({echo:e}){T.rotate(e.r/180*Math.PI),T.shadowBlur=10,T.strokeStyle=l.online?"rgb(220,240,150)":"rgb(80,100,80)",T.shadowColor=T.strokeStyle,T.fillStyle=l.online?"rgba(80,100,80,0.15)":"rgba(80,100,80,0.25)",T.beginPath(),T.moveTo(-4,0),T.arc(0,0,200,5*-Math.PI/8,3*-Math.PI/8),T.lineTo(4,0),T.fill(),T.stroke(),T.closePath()}function te(e){const{dashOffset:t=0,dashTime:n=0}=e;T.shadowBlur=10,T.strokeStyle="rgb(70,105,105)",T.shadowColor=T.strokeStyle,T.beginPath(),T.arc(0,0,100,0,Math.PI+Math.PI),T.stroke(),T.closePath(),T.beginPath(),T.lineDashOffset=t,T.setLineDash([4,8]),T.arc(0,0,40,0,Math.PI+Math.PI),T.stroke(),T.closePath(),e.dashTime=n+K,e.dashTime>U&&(e.dashTime-=U,e.dashOffset=(t-1)%12)}function ne(){T.shadowBlur=10,T.strokeStyle="rgb(55,40,35)",T.shadowColor=T.strokeStyle,T.beginPath(),T.arc(0,0,80,0,Math.PI+Math.PI),T.stroke(),T.closePath()}function ie(e,t,n,i=C,o=1){const r=o*F,a=e.length*r,s=i===R?a:i===D?a/2:0;[...e].forEach((e,i)=>{T.drawImage(O,B.indexOf(e)*F,0,F,F,t+i*r-s,n,r,r)})}function oe(){V&&(L=requestAnimationFrame(oe),(()=>{switch(T.fillStyle="rgb(20,35,40)",T.fillRect(0,0,S.width,S.height),p){case a:ie("submersible warship 2063",F,F),ie("press any key",S.width/2,S.height/2,D),r===o.length&&ie("konami mode on",S.width-F,F,R);break;case s:T.fillStyle=T.createPattern(I,"repeat"),T.fillRect(0,0,S.width,S.height),d.forEach(_),d.forEach(Y),ie(`sonar: ${l.online?"on":"off"}line`,F,F);break;case h:ie("game over",F,F),ie(`you ${w.length===w.filter(({dead:e})=>e).length?"won":"lost"}`,S.width/2,S.height/2,D)}P.drawImage(S,0,0,S.width,S.height,0,0,c.width,c.height)})(),W=Date.now(),K=(W-H)/1e3,(()=>{switch(p){case s:d.forEach(e=>{(e=>{const{strategy:t,position:n,collision:{foe:i}}=e;if(t)switch(t.type){case"lockon":const{echo:o,online:r,dead:a}=t.target;(a||!r&&z(n,o,10))&&(t.type="cruise",e.input=null);break;case"cruise":d.filter(({collision:e})=>!!e.foe&&e.foe!==i).forEach(i=>{const{echo:o}=i;z(n,o,180)&&(t.type="lockon",t.target=i,e.input=new b)})}})(e),(({input:e,position:n,strategy:i})=>{if(i)switch(i.type){case"lockon":const{target:{echo:o}}=i;e.left=Math.round(o.x)<Math.round(n.x)?-1:0,e.right=Math.round(o.x)>Math.round(n.x)?1:0,e.up=Math.round(o.y)<Math.round(n.y)?-1:0,e.down=Math.round(o.y)>Math.round(n.y)?1:0;break;case"random":i.remaining-=K,0>i.remaining&&(i.remaining+=i.nextChange,e.up=t([-1,0]),e.left=t([-1,0]),e.right=t([1,0]),e.down=t([1,0]))}})(e),(({input:e,position:t,velocity:n})=>{e&&(n.dr=e.left+e.right,n.dx=J(t,e.up+e.down),n.dy=X(t,e.up+e.down))})(e),(({velocity:e,position:t})=>{const n=e.speed*K;t.x+=n*e.dx,t.y+=n*e.dy,t.r=(t.r+n*e.dr)%360})(e),(({position:e,echo:t,sprite:n,online:i})=>{(n.alwaysRender||l.online&&i)&&(t.x=e.x,t.y=e.y,t.r=e.r)})(e),(({ttl:e})=>{e&&(e.timeLeft-=K)})(e),(e=>{const{position:t}=e;0>t.x?t.x=0:t.x>S.width-e.radius&&(t.x=S.width-e.radius),0>t.y?t.y=0:t.y>S.height-e.radius&&(t.y=S.height-e.radius)})(e)}),d.forEach((e,t)=>{d.slice(t+1).forEach(t=>{((e,t)=>{const{position:n,collision:i}=e,{position:o,collision:r}=t;return i.collide&&r.collide&&z(n,o,e.radius+t.radius)})(e,t)&&(Q(e),Q(t))})}),d=d.filter(({dead:e,ttl:t})=>!e&&(!t||t.timeLeft>0)),u.length!==u.filter(({dead:e})=>e).length&&w.length!==w.filter(({dead:e})=>e).length||(g+=K),g>4&&(p=h)}})(),H=W)}function re(e){(V=e)?(H=Date.now(),oe()):cancelAnimationFrame(L)}onload=(async e=>{i.title="Submersible Warship 2063",onresize(),I.width=I.height=64,E.strokeStyle="rgb(40,55,50)",E.beginPath(),E.moveTo(0,4),E.lineTo(8,4),E.stroke(),E.closePath(),E.beginPath(),E.moveTo(4,0),E.lineTo(4,8),E.stroke(),E.closePath(),O=await(e=>new Promise(t=>{var n=new Image;n.onload=(()=>{t(n)}),n.src=e}))(O),re(!0)}),onresize=n.onrotate=(()=>{c.width=S.width=innerWidth>1.6*innerHeight?1.6*innerHeight:innerWidth,c.height=S.height=innerWidth>1.6*innerHeight?innerHeight:innerWidth/1.6,P.imageSmoothingEnabled=T.imageSmoothingEnabled=!1}),i.onvisibilitychange=(e=>{re(!e.target.hidden)}),onkeydown=(e=>{if(e.preventDefault(),!e.repeat)switch(p){case s:switch(e.code){case"ArrowLeft":case"KeyA":l.input.left=-1;break;case"ArrowUp":case"KeyW":l.input.up=-1;break;case"ArrowRight":case"KeyD":l.input.right=1;break;case"ArrowDown":case"KeyS":l.input.down=1;break;case"Space":l.dead||(({position:e,velocity:t},n)=>{const i=new A("cruise"),o=new M(!0,!0,!1),r=new x(!1,N,ee,()=>$("rgb(220,240,150)")),a=new v(30),s=-J(e,1),h=-X(e,1),l=new k(e.x+20*s,e.y+20*h,e.r),c=new m(60,s,h);d.push(j("torpedo",{collision:o,input:null,position:l,sprite:r,strategy:i,ttl:a,velocity:c}))})(l);break;case"KeyP":re(!V)}}}),onkeyup=(e=>{switch(p){case a:e.which!==o[r]||r===o.length?Z():r++;break;case s:switch(e.code){case"ArrowLeft":case"KeyA":l.input.left=0;break;case"ArrowRight":case"KeyD":l.input.right=0;break;case"ArrowUp":case"KeyW":l.input.up=0;break;case"ArrowDown":case"KeyS":l.input.down=0;break;case"KeyO":case"KeyF":l.online=!l.online,l.switchModeTime=W}break;case h:switch(e.code){case"KeyT":open(`https://twitter.com/intent/tweet?text=I%20sunk%20${f||0}%20enemy%20submarines%20in%20Submersible%20Warship%202063%20by%20@herebefrogs%20for%20@js13kgames%202018%3A%20https%3A%2F%2Fgoo.gl%2FHLo6Df`,"_blank");break;default:r=0,p=a}}});let ae=0,se=0,he=0,le=0;function ce(e){return[e.pageX||e.changedTouches[0].pageX,e.pageY||e.changedTouches[0].pageY]}n.ontouchstart=n.onpointerdown=(e=>{switch(e.preventDefault(),p){case s:[he,le]=[ae,se]=ce(e)}}),n.ontouchmove=n.onpointermove=(e=>{switch(e.preventDefault(),p){case s:ae&&se&&(([e,t])=>{e>he?(he=e)-ae>44&&(l.input.right=1):ae>e?he-(ae=e)>44&&(l.input.left=-1):he>e&&l.input.right?(ae=e,l.input.right=0):e>ae&&l.input.left&&(he=e,l.input.left=0),t>le?(le=t)-se>44&&(l.input.down=1):se>t?le-(se=t)>44&&(l.input.up=-1):le>t&&l.input.down?(se=t,l.input.down=0):t>se&&l.input.up&&(le=t,l.input.up=0)})(ce(e))}}),n.ontouchend=n.onpointerup=(e=>{switch(e.preventDefault(),p){case a:Z();break;case s:l.input.left=l.input.right=l.input.up=l.input.down=0,ae=se=he=le=0;break;case h:r=0,p=a}})}();</script>
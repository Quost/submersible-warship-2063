<style>body{margin:0;text-align:center;background:#000;touch-action:none}canvas{image-rendering:-moz-crisp-edges;image-rendering:pixelated}</style><canvas id="c"></canvas><script>!function(){function e(e,t,n){return e>n?n:t>e?t:e}function t(e,t){return Math.floor(Math.random()*(t+1-e)+e)}function n(e){return e[t(0,e.length-1)]}const o=[38,38,40,40,37,39,37,39,66,65];let i=0;const a=0,r=1,s=2;let l,h,d,u,g,w=a,p=[],f=0;const y=180/Math.PI;function b(){this.left=0,this.right=0,this.up=0,this.down=0}function m(e,t){this.type=e,this.target=t,this.nextChange=.5,this.remaining=0}function k(e,t=0,n=0,o=0){this.speed=e,this.dx=t,this.dy=n,this.dr=o}function A(e,t,n=0){this.x=e,this.y=t,this.r=n}function T(e,t,n){this.collide=e,this.killable=t,this.foe=n}function P(e){this.timeLeft=e}function v(e,t,n,o){this.alwaysRender=e,this.renderer=t,this.radarRenderer=n,this.debrisRenderer=o}const x=c.getContext("2d"),M=c.cloneNode(),S=M.getContext("2d"),I=c.cloneNode(),E=I.getContext("2d"),C={},B=8;for(let e=0;43>e;e++)C["abcdefghijklmnopqrstuvwxyz0123456789.:!-%,/"[e]]=e*B;const D=0,R=1,F=2,U=.1;let W,K,H,L,O="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAVgAAAAIAgMAAADB+w+QAAAADFBMVEUAAAARCgP///8AAADe3w1AAAAAAXRSTlMAQObYZgAAAUlJREFUKM9VUjFuwzAMpAf5BVGB+jVeuquA6CFzUYDqZzzEQ3Z5ENr+sXeiE6MiJNFH8kTSFFXNMWtSrJhz1K7oTDgkTX2rL2L0CCkgApKp9+8kWDwvEUqU0rpUv836bWUuZjbVUvum5Vj0mIhCrEJf/Zu04yryYVBMEOBE23/afrZTHpS+mcbSbEfUrduayDCPa8zvbZiHJt1l6xSbaWkvtwgS0p4Zeij3tMOjFsQsrUC/wkvb9bcYcx3XqY4Vd2UTntlaI62xJWr3BxWwtvRaPu9ThdxAt1/3xatoQ7WvghwpsJJ8FQ/0bIuXeTxk3vOdBY/sIG5qHkFZdvoB+V6AU2Iub8NaZjlcGOIB1HH6L7M0EavIgLTQzweAMnfaflg6RcRex9lEcnwOWPIBi0lxHgMmAQDHLGjodh8o2oFm4Id4E8B3CZLlD7GmBBrI7F8nAAAAAElFTkSuQmCC",V=!0;function Z(){g=0,l=j("player",{collision:new T(!0,i!==o.length,!1),input:new b,position:new A(200,M.height-200),velocity:new k(40),sprite:new v(!0,G,oe,()=>ee("rgb(75,190,250)"))}),d=[l],u=[j("sub1",{collision:new T(!0,!0,!0),input:new b,position:new A(100,100),velocity:new k(20),strategy:new m("random"),sprite:new v(!1,_,ie,()=>ee("rgb(230,90,100)"))}),j("sub1",{collision:new T(!0,!0,!0),input:new b,position:new A(100,M.height-100),velocity:new k(20),strategy:new m("random"),sprite:new v(!1,_,ie,()=>ee("rgb(230,90,100)"))}),j("sub1",{collision:new T(!0,!0,!0),input:new b,position:new A(M.width-100,100),velocity:new k(20),strategy:new m("random"),sprite:new v(!1,_,ie,()=>ee("rgb(230,90,100)"))}),j("sub1",{collision:new T(!0,!0,!0),input:new b,position:new A(M.width-100,M.height-100),velocity:new k(20),strategy:new m("random"),sprite:new v(!1,_,ie,()=>ee("rgb(230,90,100)"))})],h=[...d,...u],w=r}function j(e,t){return{...t,echo:{...t.position},online:!0,radius:6,type:e}}function z({x:e,y:t},{x:n,y:o},i){return Math.pow(i,2)>Math.pow(e-n,2)+Math.pow(t-o,2)}function Q(e){if(e.collision.killable){e.dead=!0,e!==l&&"torpedo"!==e.type&&f++;const{position:{x:n,y:o},velocity:{dx:i,dy:a,speed:r}}=e,s=new T(!1,!1),h=new v(!0,e.sprite.debrisRenderer);[1,2,3].forEach(e=>{const l=new A(n,o),c=new k(r,i/2+t(-2,2)/10,a/2+t(-2,2)/10,t(1,e+1)*(e%2?1:-1)),d=new P(t(20,50)/10);p.push(j("debris",{collision:s,position:l,sprite:h,ttl:d,velocity:c}))})}}function J({position:e,velocity:t},{echo:n}){return(({x:e,y:t},{x:n,y:o})=>((Math.atan2(o,n)-Math.atan2(t,e))*y+180)%360-180)({x:t.dx,y:t.dy},{x:n.x-e.x,y:n.y-e.y})}function X({r:e},t){return Math.sin(-e/y)*t}function Y({r:e},t){return Math.cos(-e/y)*t}function q(){S.fillStyle=S.createPattern(I,"repeat"),S.fillRect(0,0,M.width,M.height)}function N({echo:e,sprite:t}){S.save(),S.translate(Math.round(e.x),Math.round(e.y)),S.rotate(e.r/y),t.renderer(),S.restore()}function G(){S.shadowBlur=10,S.fillStyle="rgb(75,190,250)",S.shadowColor=S.fillStyle,S.beginPath(),S.arc(0,0,5,0,2*Math.PI),S.fillRect(-2,-12,4,12),S.fill(),S.closePath()}function $(){S.shadowBlur=10,S.strokeStyle=l.online?"rgb(220,240,150)":"rgb(80,100,80)",S.lineWidth=3,S.shadowColor=S.strokeStyle,S.beginPath(),S.moveTo(0,-6),S.lineTo(0,2),S.stroke(),S.moveTo(0,4),S.lineTo(0,6),S.stroke(),S.closePath()}function _(){S.beginPath(),S.shadowBlur=10,S.fillStyle=l.online?"rgb(230,90,100)":"rgb(55,40,35)",S.shadowColor=S.fillStyle,S.fillRect(-5,-5,10,10),S.fillRect(-2,-12,4,12),S.fill(),S.closePath()}function ee(e){S.beginPath(),S.shadowBlur=10,S.fillStyle=e,S.shadowColor=S.fillStyle,S.moveTo(-5,-10),S.lineTo(5,0),S.lineTo(-4,-2),S.fill(),S.closePath()}function te(e){const{echo:t,sprite:n}=e;n.radarRenderer&&(S.save(),S.translate(Math.round(t.x),Math.round(t.y)),n.radarRenderer(e),S.restore())}function ne({echo:e}){S.rotate(e.r/y),S.shadowBlur=10,S.strokeStyle=l.online?"rgb(220,240,150)":"rgb(80,100,80)",S.shadowColor=S.strokeStyle,S.fillStyle=l.online?"rgba(80,100,80,0.15)":"rgba(80,100,80,0.25)",S.beginPath(),S.moveTo(-4,0),S.arc(0,0,200,5*-Math.PI/8,3*-Math.PI/8),S.lineTo(4,0),S.fill(),S.stroke(),S.closePath()}function oe(e){const{dashOffset:t=0,dashTime:n=0}=e;S.shadowBlur=10,S.strokeStyle="rgb(70,105,105)",S.shadowColor=S.strokeStyle,S.beginPath(),S.arc(0,0,100,0,2*Math.PI),S.stroke(),S.closePath(),S.beginPath(),S.lineDashOffset=t,S.setLineDash([4,8]),S.arc(0,0,40,0,2*Math.PI),S.stroke(),S.closePath(),e.dashTime=n+K,e.dashTime>U&&(e.dashTime-=U,e.dashOffset=(t-1)%12)}function ie(){S.shadowBlur=10,S.strokeStyle="rgb(55,40,35)",S.shadowColor=S.strokeStyle,S.beginPath(),S.arc(0,0,80,0,2*Math.PI),S.stroke(),S.closePath()}function ae(e,t,n,o=D,i=1){const a=i*B,r=e.length*a,s=o===F?r:o===R?r/2:0;[...e].forEach((e,o)=>{e in C&&S.drawImage(O,C[e],0,B,B,t+o*a-s,n,a,a)})}function re(){V&&(L=requestAnimationFrame(re),(()=>{switch(S.fillStyle="rgb(20,35,40)",S.fillRect(0,0,M.width,M.height),w){case a:q(),S.save(),S.shadowBlur=10,S.strokeStyle="rgb(70,105,105)",S.shadowColor=S.strokeStyle,S.fillStyle="rgba(30,60,60,0.5)",S.translate(M.width/2-100,100),S.save(),S.scale(.8,.8),S.rotate(35/y),S.beginPath(),S.moveTo(0,10),S.arc(0,10,20,1.5*Math.PI,.5*Math.PI),S.arc(0,-10,20,.5*Math.PI,1.5*Math.PI),S.closePath(),S.fill(),S.stroke(),S.moveTo(0,0),S.restore(),S.translate(38,0),S.beginPath(),S.arc(0,5,15,2*Math.PI,Math.PI),S.moveTo(15,5),S.lineTo(15,-20),S.lineTo(-15,-20),S.lineTo(-15,5),S.fill(),S.stroke(),S.closePath(),S.moveTo(0,0),S.translate(40,0),S.beginPath(),S.arc(0,-10,10,1.5*Math.PI,.5*Math.PI),S.moveTo(0,-20),S.lineTo(-15,-20),S.lineTo(-15,20),S.lineTo(0,20),S.moveTo(0,0),S.arc(0,10,10,1.5*Math.PI,.5*Math.PI),S.fill(),S.stroke(),S.closePath(),S.moveTo(0,0),S.translate(40,0),S.beginPath(),S.moveTo(0,0),S.lineTo(7.5,20),S.lineTo(22.5,-20),S.lineTo(-22.5,-20),S.lineTo(-7.5,20),S.lineTo(7.5,-20),S.fill(),S.stroke(),S.closePath(),S.translate(35,0),S.moveTo(0,0),S.beginPath(),S.lineTo(0,-20),S.lineTo(-15,20),S.lineTo(15,20),S.lineTo(0,-20),S.fill(),S.stroke(),S.closePath(),S.translate(40,0),S.beginPath(),S.arc(0,-10,10,1.5*Math.PI,.5*Math.PI),S.moveTo(0,-20),S.lineTo(-15,-20),S.lineTo(-15,20),S.lineTo(10,20),S.lineTo(0,0),S.fill(),S.stroke(),S.closePath(),S.moveTo(0,0),S.translate(-100,70),S.font="54px Arial",S.textAlign="center",S.textBase="bottom",S.fillText("2063",0,0),S.strokeText("2063",0,0),S.restore(),ae("press any key",M.width/2,M.height/2,R),i===o.length&&ae("konami mode on",M.width-B,B,F);break;case r:q(),h.forEach(te),h.forEach(N),ae(`sonar: ${l.online?"on":"off"}line`,B,B);break;case s:ae("game over",B,B),ae(`you ${u.length===u.filter(({dead:e})=>e).length?"won":"lost"}`,M.width/2,M.height/2,R)}x.drawImage(M,0,0,M.width,M.height,0,0,c.width,c.height)})(),W=Date.now(),K=(W-H)/1e3,(()=>{switch(w){case r:h.forEach(t=>{(e=>{const{strategy:t,position:n,collision:{foe:o}}=e;if(t)switch(t.type){case"lockon":const{echo:i,online:a,dead:r}=t.target;(r||!a&&z(n,i,10))&&(e.strategy={...t,type:"cruise",target:void 0,nextChange:.5,remaining:0},e.input=null,e.velocity.dr=0);break;case"cruise":h.filter(({collision:e})=>!!e.foe&&e.foe!==o).forEach(o=>{const{echo:i}=o;z(n,i,180)&&22.5>Math.abs(J(e,o))&&(e.strategy={...t,type:"lockon",target:o,nextChange:.1,remaining:0},t.target=o,e.input=new b)})}})(t),(e=>{const{input:t,strategy:o}=e;if(o&&(o.remaining-=K,0>o.remaining))switch(o.remaining+=o.nextChange,o.type){case"lockon":const i=J(e,o.target);t.left=-5>i?-1:0,t.right=i>5?1:0,t.up=-1,t.down=0;break;case"random":t.up=n([-1,0]),t.left=n([-1,0]),t.right=n([1,0]),t.down=n([1,0])}})(t),(({input:e,position:t,velocity:n})=>{e&&(n.dr=e.left+e.right,n.dx=X(t,e.up+e.down),n.dy=Y(t,e.up+e.down))})(t),(({velocity:e,position:t})=>{const n=e.speed*K;t.x+=n*e.dx,t.y+=n*e.dy,t.r=(t.r+n*e.dr)%360})(t),(({position:e,echo:t,sprite:n,online:o})=>{(n.alwaysRender||l.online&&o)&&(t.x=e.x,t.y=e.y,t.r=e.r)})(t),(e=>{let{ttl:t}=e;t&&(t.timeLeft-=K,1>t.timeLeft&&(e.dead=!0))})(t),(t=>{const{position:n}=t;n.x=e(n.x,0,M.width-t.radius),n.y=e(n.y,0,M.height-t.radius)})(t)});let t=new Set;h.forEach((e,n)=>{h.slice(n+1).forEach(n=>{((e,t)=>{const{position:n,collision:o}=e,{position:i,collision:a}=t;return o.collide&&a.collide&&z(n,i,e.radius+t.radius)})(e,n)&&(t.add(e),t.add(n))})}),t.forEach(Q),h=h.filter(({dead:e})=>!e),p.length>0&&(p.forEach(e=>h.push(e)),p=[]),d.length!==d.filter(({dead:e})=>e).length&&u.length!==u.filter(({dead:e})=>e).length||(g+=K),g>4&&(w=s)}})(),H=W)}function se(e){(V=e)?(H=Date.now(),re()):cancelAnimationFrame(L)}onload=(async e=>{document.title="Submersible Warship 2063",onresize(),I.width=I.height=64,E.strokeStyle="rgb(40,55,50)",E.beginPath(),E.moveTo(0,4),E.lineTo(8,4),E.stroke(),E.closePath(),E.beginPath(),E.moveTo(4,0),E.lineTo(4,8),E.stroke(),E.closePath(),O=await(e=>new Promise(t=>{let n=new Image;n.onload=(()=>t(n)),n.src=e}))(O),se(!0)}),onresize=onrotate=(()=>{c.width=M.width=innerWidth>1.6*innerHeight?1.6*innerHeight:innerWidth,c.height=M.height=innerWidth>1.6*innerHeight?innerHeight:innerWidth/1.6,x.imageSmoothingEnabled=S.imageSmoothingEnabled=!1}),document.onvisibilitychange=(e=>{se(!e.target.hidden)}),onkeydown=(e=>{if(e.preventDefault(),!e.repeat)switch(w){case r:switch(e.code){case"ArrowLeft":case"KeyA":l.input.left=-1;break;case"ArrowUp":case"KeyW":l.input.up=-1;break;case"ArrowRight":case"KeyD":l.input.right=1;break;case"ArrowDown":case"KeyS":l.input.down=1;break;case"Space":l.dead||(({position:e},t)=>{const n=new m("cruise"),o=new T(!0,!0,!1),i=new v(!1,$,ne,()=>ee("rgb(220,240,150)")),a=new P(30),r=X(e,-1),s=Y(e,-1),l=new A(e.x+20*r,e.y+20*s,e.r),h=new k(60,r,s);p.push(j("torpedo",{collision:o,input:null,position:l,sprite:i,strategy:n,ttl:a,velocity:h}))})(l);break;case"KeyP":se(!V)}}}),onkeyup=(e=>{switch(w){case a:e.which!==o[i]||i===o.length?Z():i++;break;case r:switch(e.code){case"ArrowLeft":case"KeyA":l.input.left=0;break;case"ArrowRight":case"KeyD":l.input.right=0;break;case"ArrowUp":case"KeyW":l.input.up=0;break;case"ArrowDown":case"KeyS":l.input.down=0;break;case"KeyO":case"KeyF":l.online=!l.online,l.switchModeTime=W}break;case s:switch(e.code){case"KeyT":open(`https://twitter.com/intent/tweet?text=I%20sunk%20${f||0}%20enemy%20submarines%20in%20Submersible%20Warship%202063%20by%20@herebefrogs%20for%20@js13kgames%202018%3A%20https%3A%2F%2Fgoo.gl%2FHLo6Df`,"_blank");break;default:i=0,w=a}}});let le=0,he=0,ce=0,de=0;function ue(e){return[e.pageX||e.changedTouches[0].pageX,e.pageY||e.changedTouches[0].pageY]}ontouchstart=onpointerdown=(e=>{switch(e.preventDefault(),w){case r:[ce,de]=[le,he]=ue(e)}}),ontouchmove=onpointermove=(e=>{switch(e.preventDefault(),w){case r:le&&he&&(([e,t])=>{e>ce?(ce=e)-le>44&&(l.input.right=1):le>e?ce-(le=e)>44&&(l.input.left=-1):ce>e&&l.input.right?(le=e,l.input.right=0):e>le&&l.input.left&&(ce=e,l.input.left=0),t>de?(de=t)-he>44&&(l.input.down=1):he>t?de-(he=t)>44&&(l.input.up=-1):de>t&&l.input.down?(he=t,l.input.down=0):t>he&&l.input.up&&(de=t,l.input.up=0)})(ue(e))}}),ontouchend=onpointerup=(e=>{switch(e.preventDefault(),w){case a:Z();break;case r:l.input.left=l.input.right=l.input.up=l.input.down=0,le=he=ce=de=0;break;case s:i=0,w=a}})}();</script>
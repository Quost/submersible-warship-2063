<style>body{margin:0;text-align:center;background:#000;touch-action:none}</style><canvas id="c"></canvas><script>!function(){function e(e,t){return Math.floor(Math.random()*(t+1-e)+e)}function t(t){return t[e(0,t.length-1)]}const n=window,i=document,o=[38,38,40,40,37,39,37,39,66,65];let r=0;const a=0,s=1,h=2;let l,d,u,w,g,p=a,y=0;function f(){this.left=this.right=this.up=this.down=0}function b(e,t){this.type=e,this.target=t,this.nextChange=2,this.remaining=0}function A(e,t=0,n=0,i=0){this.speed=e,this.dx=t,this.dy=n,this.dr=i}function m(e,t,n=0){this.x=e,this.y=t,this.r=n}function k(e,t){this.collide=e,this.killable=t}function x(e){this.timeLeft=e}function M(e,t,n,i){this.alwaysRender=e,this.renderer=t,this.radarRenderer=n,this.debrisRenderer=i}const v=c.getContext("2d"),P=c.cloneNode(),S=P.getContext("2d"),T=c.cloneNode(),I=T.getContext("2d"),E="abcdefghijklmnopqrstuvwxyz0123456789.:!-%,/",B=0,C=1,D=2,R=8,F=.1;let U,W,K,H,L="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAVgAAAAIAgMAAADB+w+QAAAADFBMVEUAAAARCgP///8AAADe3w1AAAAAAXRSTlMAQObYZgAAAUlJREFUKM9VUjFuwzAMpAf5BVGB+jVeuquA6CFzUYDqZzzEQ3Z5ENr+sXeiE6MiJNFH8kTSFFXNMWtSrJhz1K7oTDgkTX2rL2L0CCkgApKp9+8kWDwvEUqU0rpUv836bWUuZjbVUvum5Vj0mIhCrEJf/Zu04yryYVBMEOBE23/afrZTHpS+mcbSbEfUrduayDCPa8zvbZiHJt1l6xSbaWkvtwgS0p4Zeij3tMOjFsQsrUC/wkvb9bcYcx3XqY4Vd2UTntlaI62xJWr3BxWwtvRaPu9ThdxAt1/3xatoQ7WvghwpsJJ8FQ/0bIuXeTxk3vOdBY/sIG5qHkFZdvoB+V6AU2Iub8NaZjlcGOIB1HH6L7M0EavIgLTQzweAMnfaflg6RcRex9lEcnwOWPIBi0lxHgMmAQDHLGjodh8o2oFm4Id4E8B3CZLlD7GmBBrI7F8nAAAAAElFTkSuQmCC",O=!0;function V(){g=0,l=Z("player",{collision:new k(!0,r!==o.length),input:new f,position:new m(200,P.height-200),velocity:new A(40),sprite:new M(!0,J,_,()=>N("rgb(75,190,250)"))}),u=[l],w=[Z("sub1",{collision:new k(!0,!0),input:new f,position:new m(100,100),velocity:new A(20),strategy:new b("random"),sprite:new M(!1,Y,ee,()=>N("rgb(230,90,100)"))}),Z("sub1",{collision:new k(!0,!0),input:new f,position:new m(100,P.height-100),velocity:new A(20),strategy:new b("random"),sprite:new M(!1,Y,ee,()=>N("rgb(230,90,100)"))}),Z("sub1",{collision:new k(!0,!0),input:new f,position:new m(P.width-100,100),velocity:new A(20),strategy:new b("random"),sprite:new M(!1,Y,ee,()=>N("rgb(230,90,100)"))}),Z("sub1",{collision:new k(!0,!0),input:new f,position:new m(P.width-100,P.height-100),velocity:new A(20),strategy:new b("random"),sprite:new M(!1,Y,ee,()=>N("rgb(230,90,100)"))})],d=[...u,...w],p=s}function Z(e,t){return{...t,echo:{...t.position},online:!0,radius:6,type:e}}function j({x:e,y:t},{x:n,y:i},o){return Math.pow(o,2)>Math.pow(e-n,2)+Math.pow(t-i,2)}function z(t){if(t.collision.killable){t.dead=!0,t!==l&&"torpedo"!==t.type&&y++;const{position:{x:n,y:i},velocity:{dx:o,dy:r,speed:a}}=t,s=new k(!1,!1),h=new M(!0,t.sprite.debrisRenderer);[1,2,3].forEach(t=>{const l=new m(n,i),c=new A(a,o/2+e(-2,2)/10,r/2+e(-2,2)/10,e(1,t+1)*(t%2?1:-1)),u=new x(e(20,50)/10);d.push(Z("debris",{collision:s,position:l,sprite:h,ttl:u,velocity:c}))})}}const Q=Math.sqrt(.5);function q({echo:e,sprite:t}){S.save(),S.translate(Math.round(e.x),Math.round(e.y)),S.rotate(e.r/180*Math.PI),t.renderer(),S.restore()}function J(){S.shadowBlur=10,S.fillStyle="rgb(75,190,250)",S.shadowColor=S.fillStyle,S.beginPath(),S.arc(0,0,5,0,Math.PI+Math.PI),S.fillRect(-2,-12,4,12),S.fill(),S.closePath()}function X(){S.shadowBlur=10,S.strokeStyle=l.online?"rgb(220,240,150)":"rgb(80,100,80)",S.lineWidth=3,S.shadowColor=S.strokeStyle,S.beginPath(),S.moveTo(0,-6),S.lineTo(0,2),S.stroke(),S.moveTo(0,4),S.lineTo(0,6),S.stroke(),S.closePath()}function Y(){S.beginPath(),S.shadowBlur=10,S.fillStyle=l.online?"rgb(230,90,100)":"rgb(55,40,35)",S.shadowColor=S.fillStyle,S.fillRect(-5,-5,10,10),S.fillRect(-2,-12,4,12),S.fill(),S.closePath()}function N(e){S.beginPath(),S.shadowBlur=10,S.fillStyle=e,S.shadowColor=S.fillStyle,S.moveTo(-5,-10),S.lineTo(5,0),S.lineTo(-4,-2),S.fill(),S.closePath()}function G(e){const{echo:t,sprite:n}=e;n.radarRenderer&&(S.save(),S.translate(Math.round(t.x),Math.round(t.y)),n.radarRenderer(e),S.restore())}function $({echo:e}){S.rotate(e.r/180*Math.PI),S.shadowBlur=10,S.strokeStyle=l.online?"rgb(220,240,150)":"rgb(80,100,80)",S.shadowColor=S.strokeStyle,S.fillStyle=l.online?"rgba(80,100,80,0.15)":"rgba(80,100,80,0.25)",S.beginPath(),S.moveTo(-4,0),S.arc(0,0,200,5*-Math.PI/8,3*-Math.PI/8),S.lineTo(4,0),S.fill(),S.stroke(),S.closePath()}function _(e){const{dashOffset:t=0,dashTime:n=0}=e;S.shadowBlur=10,S.strokeStyle="rgb(70,105,105)",S.shadowColor=S.strokeStyle,S.beginPath(),S.arc(0,0,100,0,Math.PI+Math.PI),S.stroke(),S.closePath(),S.beginPath(),S.lineDashOffset=t,S.setLineDash([4,8]),S.arc(0,0,40,0,Math.PI+Math.PI),S.stroke(),S.closePath(),e.dashTime=n+W,e.dashTime>F&&(e.dashTime-=F,e.dashOffset=(t-1)%12)}function ee(){S.shadowBlur=10,S.strokeStyle="rgb(55,40,35)",S.shadowColor=S.strokeStyle,S.beginPath(),S.arc(0,0,80,0,Math.PI+Math.PI),S.stroke(),S.closePath()}function te(e,t,n,i=B,o=1){const r=o*R,a=e.length*r,s=i===D?a:i===C?a/2:0;[...e].forEach((e,i)=>{S.drawImage(L,E.indexOf(e)*R,0,R,R,t+i*r-s,n,r,r)})}function ne(){O&&(H=requestAnimationFrame(ne),(()=>{switch(S.fillStyle="rgb(20,35,40)",S.fillRect(0,0,P.width,P.height),p){case a:te("submersible warship 2063",R,R),te("press any key",P.width/2,P.height/2,C),r===o.length&&te("konami mode on",P.width-R,R,D);break;case s:S.fillStyle=S.createPattern(T,"repeat"),S.fillRect(0,0,P.width,P.height),d.forEach(G),d.forEach(q),te(`sonar: ${l.online?"on":"off"}line`,R,R);break;case h:te("game over",R,R),te(`you ${w.length===w.filter(({dead:e})=>e).length?"won":"lost"}`,P.width/2,P.height/2,C)}v.drawImage(P,0,0,P.width,P.height,0,0,c.width,c.height)})(),U=Date.now(),W=(U-K)/1e3,(()=>{switch(p){case s:d.forEach(e=>{(e=>{const{strategy:t,position:n}=e;if(t)switch(t.type){case"track":const{echo:i,online:o}=t.target;!o&&j(n,i,10)&&(t.type="cruise",e.input=null);break;case"cruise":w.forEach(i=>{const{echo:o}=i;j(n,o,180)&&(t.type="track",t.target=i,e.input=new f)})}})(e),(({input:e,position:n,strategy:i})=>{if(i)switch(i.type){case"track":const{target:{echo:o}}=i;e.left=Math.round(o.x)<Math.round(n.x)?-1:0,e.right=Math.round(o.x)>Math.round(n.x)?1:0,e.up=Math.round(o.y)<Math.round(n.y)?-1:0,e.down=Math.round(o.y)>Math.round(n.y)?1:0;break;case"random":i.remaining-=W,0>i.remaining&&(i.remaining+=i.nextChange,e.up=t([-1,0]),e.left=t([-1,0]),e.right=t([1,0]),e.down=t([1,0]))}})(e),(({input:e,velocity:t})=>{e&&(t.dx=e.left+e.right,t.dy=e.up+e.down,t.dx&&t.dy&&(t.dx*=Q,t.dy*=Q))})(e),(({velocity:e,position:t})=>{const n=e.speed*W;t.x+=n*e.dx,t.y+=n*e.dy,e.dr?t.r=(t.r+n*e.dr)%360:t.r=0>e.dx&&0>e.dy?315:0>e.dx&&0===e.dy?270:0>e.dx&&e.dy>0?225:0===e.dx&&0>e.dy?0:e.dx>0&&0>e.dy?45:e.dx>0&&0===e.dy?90:e.dx>0&&e.dy>0?135:0===e.dx&&e.dy>0?180:t.r})(e),(({position:e,echo:t,sprite:n,online:i})=>{(n.alwaysRender||l.online&&i)&&(t.x=e.x,t.y=e.y,t.r=e.r)})(e),(({ttl:e})=>{e&&(e.timeLeft-=W)})(e),(e=>{const{position:t}=e;0>t.x?t.x=0:t.x>P.width-e.radius&&(t.x=P.width-e.radius),0>t.y?t.y=0:t.y>P.height-e.radius&&(t.y=P.height-e.radius)})(e)}),d.forEach((e,t)=>{d.slice(t+1).forEach(t=>{((e,t)=>{const{position:n,collision:i}=e,{position:o,collision:r}=t;return i.collide&&r.collide&&j(n,o,e.radius+t.radius)})(e,t)&&(z(e),z(t))})}),d=d.filter(({dead:e,ttl:t})=>!e&&(!t||t.timeLeft>0)),u.length!==u.filter(({dead:e})=>e).length&&w.length!==w.filter(({dead:e})=>e).length||(g+=W),g>4&&(p=h)}})(),K=U)}function ie(e){(O=e)?(K=Date.now(),ne()):cancelAnimationFrame(H)}onload=(async e=>{i.title="Submersible Warship 2063",onresize(),T.width=T.height=64,I.strokeStyle="rgb(40,55,50)",I.beginPath(),I.moveTo(0,4),I.lineTo(8,4),I.stroke(),I.closePath(),I.beginPath(),I.moveTo(4,0),I.lineTo(4,8),I.stroke(),I.closePath(),L=await(e=>new Promise(t=>{var n=new Image;n.onload=(()=>{t(n)}),n.src=e}))(L),ie(!0)}),onresize=n.onrotate=(()=>{c.width=P.width=innerWidth>1.6*innerHeight?1.6*innerHeight:innerWidth,c.height=P.height=innerWidth>1.6*innerHeight?innerHeight:innerWidth/1.6,v.imageSmoothingEnabled=S.imageSmoothingEnabled=!1}),i.onvisibilitychange=(e=>{ie(!e.target.hidden)}),onkeydown=(e=>{if(e.preventDefault(),!e.repeat)switch(p){case s:switch(e.code){case"ArrowLeft":case"KeyA":l.input.left=-1;break;case"ArrowUp":case"KeyW":l.input.up=-1;break;case"ArrowRight":case"KeyD":l.input.right=1;break;case"ArrowDown":case"KeyS":l.input.down=1;break;case"Space":l.dead||(({position:e,velocity:t},n)=>{const i=new b("cruise"),o=new k(!0,!0),r=new M(!1,X,$,()=>N("rgb(220,240,150)")),a=new x(30);let s,h;t.dx||t.dy?(s=t.dx,h=t.dy):0===e.r?(s=0,h=-1):90===e.r?(s=1,h=0):180===e.r?(s=0,h=1):270===e.r&&(s=-1,h=0);let l=e.x,c=e.y;0===e.r?c-=20:45===e.r?(l+=15,c-=15):90===e.r?l+=20:135===e.r?(l+=15,c+=15):180===e.r?c+=20:225===e.r?(l-=15,c+=15):270===e.r?l-=20:315===e.r&&(l-=15,c-=15);const u=new m(l,c,e.r),w=new A(60,s,h);d.push(Z("torpedo",{collision:o,input:null,position:u,sprite:r,strategy:i,ttl:a,velocity:w}))})(l);break;case"KeyP":ie(!O)}}}),onkeyup=(e=>{switch(p){case a:e.which!==o[r]||r===o.length?V():r++;break;case s:switch(e.code){case"ArrowLeft":case"KeyA":l.input.left=0;break;case"ArrowRight":case"KeyD":l.input.right=0;break;case"ArrowUp":case"KeyW":l.input.up=0;break;case"ArrowDown":case"KeyS":l.input.down=0;break;case"KeyO":case"KeyF":l.online=!l.online,l.switchModeTime=U}break;case h:switch(e.code){case"KeyT":open(`https://twitter.com/intent/tweet?text=I%20sunk%20${y||0}%20enemy%20submarines%20in%20Submersible%20Warship%202063%20by%20@herebefrogs%20for%20@js13kgames%202018%3A%20https%3A%2F%2Fgoo.gl%2FHLo6Df`,"_blank");break;default:r=0,p=a}}});let oe=0,re=0,ae=0,se=0;function he(e){return[e.pageX||e.changedTouches[0].pageX,e.pageY||e.changedTouches[0].pageY]}n.ontouchstart=n.onpointerdown=(e=>{switch(e.preventDefault(),p){case s:[ae,se]=[oe,re]=he(e)}}),n.ontouchmove=n.onpointermove=(e=>{switch(e.preventDefault(),p){case s:oe&&re&&(([e,t])=>{e>ae?(ae=e)-oe>44&&(l.input.right=1):oe>e?ae-(oe=e)>44&&(l.input.left=-1):ae>e&&l.input.right?(oe=e,l.input.right=0):e>oe&&l.input.left&&(ae=e,l.input.left=0),t>se?(se=t)-re>44&&(l.input.down=1):re>t?se-(re=t)>44&&(l.input.up=-1):se>t&&l.input.down?(re=t,l.input.down=0):t>re&&l.input.up&&(se=t,l.input.up=0)})(he(e))}}),n.ontouchend=n.onpointerup=(e=>{switch(e.preventDefault(),p){case a:V();break;case s:l.input.left=l.input.right=l.input.up=l.input.down=0,oe=re=ae=se=0;break;case h:r=0,p=a}})}();</script>
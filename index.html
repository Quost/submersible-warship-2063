<style>body{margin:0;text-align:center;background:#000;touch-action:none}</style><canvas id="c"></canvas><script>!function(){function e(e,t){return Math.floor(Math.random()*(t+1-e)+e)}function t(t){return t[e(0,t.length-1)]}const i=window,n=document,o=[38,38,40,40,37,39,37,39,66,65];let r=0;const a=0,s=1,l=2;let h,d,u,w=a;function p(){this.left=this.right=this.up=this.down=0}function g(e){this.nextChange=this.remaining=e}function f(e){this.dx=this.dy=this.dr=0,this.speed=e}function y(e,t){this.x=e,this.y=t,this.r=0}function b(e,t){this.collide=e,this.killable=t}function A(e){this.timeLeft=e}function x(e,t,i,n){this.alwaysRender=e,this.renderer=t,this.radarRenderer=i,this.debrisRenderer=n}const k=c.getContext("2d"),m=c.cloneNode(),v=m.getContext("2d"),P=c.cloneNode(),M=P.getContext("2d"),I="abcdefghijklmnopqrstuvwxyz0123456789.:!-%,/",S=0,T=1,E=2,B=8,C=.1;let D,R,F,U,K="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAVgAAAAIAgMAAADB+w+QAAAADFBMVEUAAAARCgP///8AAADe3w1AAAAAAXRSTlMAQObYZgAAAUlJREFUKM9VUjFuwzAMpAf5BVGB+jVeuquA6CFzUYDqZzzEQ3Z5ENr+sXeiE6MiJNFH8kTSFFXNMWtSrJhz1K7oTDgkTX2rL2L0CCkgApKp9+8kWDwvEUqU0rpUv836bWUuZjbVUvum5Vj0mIhCrEJf/Zu04yryYVBMEOBE23/afrZTHpS+mcbSbEfUrduayDCPa8zvbZiHJt1l6xSbaWkvtwgS0p4Zeij3tMOjFsQsrUC/wkvb9bcYcx3XqY4Vd2UTntlaI62xJWr3BxWwtvRaPu9ThdxAt1/3xatoQ7WvghwpsJJ8FQ/0bIuXeTxk3vOdBY/sIG5qHkFZdvoB+V6AU2Iub8NaZjlcGOIB1HH6L7M0EavIgLTQzweAMnfaflg6RcRex9lEcnwOWPIBi0lxHgMmAQDHLGjodh8o2oFm4Id4E8B3CZLlD7GmBBrI7F8nAAAAAElFTkSuQmCC",W=!0;function H(){h=60,d=L("player",{collision:new b(!0,r!==o.length),input:new p,position:new y(200,m.height-200),velocity:new f(40),sprite:new x(!0,z,Y,()=>q("rgb(75,190,250)"))}),u=[d,L("sub1",{artificialInput:new g(4),collision:new b(!0,!0),position:new y(100,100),velocity:new f(20),sprite:new x(!1,Q,G,()=>q("rgb(230,90,100)"))}),L("sub1",{artificialInput:new g(3),collision:new b(!0,!0),position:new y(100,m.height-100),velocity:new f(20),sprite:new x(!1,Q,G,()=>q("rgb(230,90,100)"))}),L("sub1",{artificialInput:new g(6),collision:new b(!0,!0),position:new y(m.width-100,100),velocity:new f(20),sprite:new x(!1,Q,G,()=>q("rgb(230,90,100)"))}),L("sub1",{artificialInput:new g(5),collision:new b(!0,!0),position:new y(m.width-100,m.height-100),velocity:new f(20),sprite:new x(!1,Q,G,()=>q("rgb(230,90,100)"))})],w=s}function L(e,{artificialInput:t,collision:i,input:n,position:o,sprite:r,ttl:a,velocity:s}){return{artificialInput:t,collision:i,echo:{...o},input:n,position:o,sprite:r,ttl:a,velocity:s,online:!0,radius:6,type:e}}function O(t){if(t.collision.killable){t.dead=!0;const{position:{x:i,y:n},velocity:{dx:o,dy:r,speed:a}}=t,s=new b(!1,!1),l=new x(!0,t.sprite.debrisRenderer);[1,2,3].forEach(t=>{const h=new y(i,n),c=new f(a);c.dx=o/2+e(-2,2)/10,c.dy=r/2+e(-2,2)/10,c.dr=e(1,t+1)*(t%2?1:-1);const d=new A(e(20,50)/10);u.push(L("debris",{collision:s,position:h,sprite:l,ttl:d,velocity:c}))})}}const V=Math.sqrt(.5);function Z({echo:e,sprite:t}){v.save(),v.translate(Math.round(e.x),Math.round(e.y)),v.rotate(e.r/180*Math.PI),t.renderer(),v.restore()}function z(){v.shadowBlur=10,v.fillStyle="rgb(75,190,250)",v.shadowColor=v.fillStyle,v.beginPath(),v.arc(0,0,5,0,Math.PI+Math.PI),v.fillRect(-2,-12,4,12),v.fill(),v.closePath()}function j(){v.shadowBlur=10,v.strokeStyle=d.online?"rgb(220,240,150)":"rgb(80,100,80)",v.lineWidth=3,v.shadowColor=v.strokeStyle,v.beginPath(),v.moveTo(0,-6),v.lineTo(0,2),v.stroke(),v.moveTo(0,4),v.lineTo(0,6),v.stroke(),v.closePath()}function Q(){v.beginPath(),v.shadowBlur=10,v.fillStyle=d.online?"rgb(230,90,100)":"rgb(55,40,35)",v.shadowColor=v.fillStyle,v.fillRect(-5,-5,10,10),v.fillRect(-2,-12,4,12),v.fill(),v.closePath()}function q(e){v.beginPath(),v.shadowBlur=10,v.fillStyle=e,v.shadowColor=v.fillStyle,v.moveTo(-5,-10),v.lineTo(5,0),v.lineTo(-4,-2),v.fill(),v.closePath()}function J(e){const{echo:t,sprite:i}=e;i.radarRenderer&&(v.save(),v.translate(Math.round(t.x),Math.round(t.y)),i.radarRenderer(e),v.restore())}function X({echo:e}){v.rotate(e.r/180*Math.PI),v.shadowBlur=10,v.strokeStyle=d.online?"rgb(220,240,150)":"rgb(80,100,80)",v.shadowColor=v.strokeStyle,v.fillStyle=d.online?"rgba(80,100,80,0.15)":"rgba(80,100,80,0.25)",v.beginPath(),v.moveTo(-4,0),v.arc(0,0,200,5*-Math.PI/8,3*-Math.PI/8),v.lineTo(4,0),v.fill(),v.stroke(),v.closePath()}function Y(e){const{dashOffset:t=0,dashTime:i=0}=e;v.shadowBlur=10,v.strokeStyle="rgb(70,105,105)",v.shadowColor=v.strokeStyle,v.beginPath(),v.arc(0,0,100,0,Math.PI+Math.PI),v.stroke(),v.closePath(),v.beginPath(),v.lineDashOffset=t,v.setLineDash([4,8]),v.arc(0,0,40,0,Math.PI+Math.PI),v.stroke(),v.closePath(),e.dashTime=i+R,e.dashTime>C&&(e.dashTime-=C,e.dashOffset=(t-1)%12)}function G(){v.shadowBlur=10,v.strokeStyle="rgb(55,40,35)",v.shadowColor=v.strokeStyle,v.beginPath(),v.arc(0,0,80,0,Math.PI+Math.PI),v.stroke(),v.closePath()}function N(e,t,i,n=S,o=1){const r=o*B,a=e.length*r,s=n===E?a:n===T?a/2:0;[...e].forEach((e,n)=>{v.drawImage(K,I.indexOf(e)*B,0,B,B,t+n*r-s,i,r,r)})}function $(){W&&(U=requestAnimationFrame($),(()=>{switch(v.fillStyle="rgb(20,35,40)",v.fillRect(0,0,m.width,m.height),w){case a:N("subwar 2051",B,B),N("press any key",m.width/2,m.height/2,T),r===o.length&&N("konami mode on",m.width-B,B,E);break;case s:v.fillStyle=v.createPattern(P,"repeat"),v.fillRect(0,0,m.width,m.height),u.forEach(J),u.forEach(Z),N(`sonar: ${d.online?"on":"off"}line`,B,B),(()=>{const e=Math.floor(Math.ceil(h)/60),t=Math.ceil(h)-60*e;N(`${e}:${t>9?"":"0"}${t}`,m.width-B,B,E)})();break;case l:N("game over",B,B)}k.drawImage(m,0,0,m.width,m.height,0,0,c.width,c.height)})(),D=Date.now(),R=(D-F)/1e3,(()=>{switch(w){case s:0>(h-=R)&&(w=l),u.forEach(e=>{(({artificialInput:e,velocity:i})=>{e&&(e.remaining-=R,0>e.remaining&&(e.remaining+=e.nextChange,i.dx=t([-1,0,1]),i.dy=t([-1,0,1]),i.dx&&i.dy&&(i.dx*=V,i.dy*=V)))})(e),(({input:e,velocity:t})=>{e&&(t.dx=e.left+e.right,t.dy=e.up+e.down,t.dx&&t.dy&&(t.dx*=V,t.dy*=V))})(e),(({velocity:e,position:t})=>{const i=e.speed*R;t.x+=i*e.dx,t.y+=i*e.dy,e.dr?t.r=(t.r+i*e.dr)%360:t.r=0>e.dx&&0>e.dy?315:0>e.dx&&0===e.dy?270:0>e.dx&&e.dy>0?225:0===e.dx&&0>e.dy?0:e.dx>0&&0>e.dy?45:e.dx>0&&0===e.dy?90:e.dx>0&&e.dy>0?135:0===e.dx&&e.dy>0?180:t.r})(e),(({position:e,echo:t,sprite:i,online:n})=>{(i.alwaysRender||d.online&&n)&&(t.x=e.x,t.y=e.y,t.r=e.r)})(e),(({ttl:e})=>{e&&(e.timeLeft-=R)})(e),(e=>{const{position:t}=e;0>t.x?t.x=0:t.x>m.width-e.radius&&(t.x=m.width-e.radius),0>t.y?t.y=0:t.y>m.height-e.radius&&(t.y=m.height-e.radius)})(e)}),u.forEach((e,t)=>{u.slice(t+1).forEach(t=>{((e,t)=>{const{position:i,collision:n}=e,{position:o,collision:r}=t;return n.collide&&r.collide&&Math.pow(e.radius+t.radius,2)>Math.pow(i.x-o.x,2)+Math.pow(i.y-o.y,2)})(e,t)&&(O(e),O(t))})}),u=u.filter(({dead:e,ttl:t})=>!e&&(!t||t.timeLeft>0))}})(),F=D)}function _(e){(W=e)?(F=Date.now(),$()):cancelAnimationFrame(U)}onload=(async e=>{n.title="Subwar 2051",onresize(),P.width=P.height=64,M.strokeStyle="rgb(40,55,50)",M.beginPath(),M.moveTo(0,4),M.lineTo(8,4),M.stroke(),M.closePath(),M.beginPath(),M.moveTo(4,0),M.lineTo(4,8),M.stroke(),M.closePath(),K=await(e=>new Promise(t=>{var i=new Image;i.onload=(()=>{t(i)}),i.src=e}))(K),_(!0)}),onresize=i.onrotate=(()=>{c.width=m.width=innerWidth>1.6*innerHeight?1.6*innerHeight:innerWidth,c.height=m.height=innerWidth>1.6*innerHeight?innerHeight:innerWidth/1.6,k.imageSmoothingEnabled=v.imageSmoothingEnabled=!1}),n.onvisibilitychange=(e=>{_(!e.target.hidden)}),onkeydown=(e=>{if(e.preventDefault(),!e.repeat)switch(w){case s:switch(e.code){case"ArrowLeft":case"KeyA":d.input.left=-1;break;case"ArrowUp":case"KeyW":d.input.up=-1;break;case"ArrowRight":case"KeyD":d.input.right=1;break;case"ArrowDown":case"KeyS":d.input.down=1;break;case"Space":d.dead||(({position:e,velocity:t})=>{const i=new b(!0,!0),n=new x(!1,j,X,()=>q("rgb(220,240,150)")),o=new A(30);let r,a;t.dx||t.dy?(r=t.dx,a=t.dy):0===e.r?(r=0,a=-1):90===e.r?(r=1,a=0):180===e.r?(r=0,a=1):270===e.r&&(r=-1,a=0);let s=e.x,l=e.y;0===e.r?l-=20:45===e.r?(s+=15,l-=15):90===e.r?s+=20:135===e.r?(s+=15,l+=15):180===e.r?l+=20:225===e.r?(s-=15,l+=15):270===e.r?s-=20:315===e.r&&(s-=15,l-=15);const h=new y(s,l);h.r=e.r;const c=new f(60);c.dx=r,c.dy=a,u.push(L("torpedo",{collision:i,position:h,sprite:n,ttl:o,velocity:c}))})(d);break;case"KeyP":_(!W)}}}),onkeyup=(e=>{switch(w){case a:e.which!==o[r]||r===o.length?H():r++;break;case s:switch(e.code){case"ArrowLeft":case"KeyA":d.input.left=0;break;case"ArrowRight":case"KeyD":d.input.right=0;break;case"ArrowUp":case"KeyW":d.input.up=0;break;case"ArrowDown":case"KeyS":d.input.down=0;break;case"KeyO":case"KeyF":d.online=!d.online,d.switchModeTime=D}break;case l:switch(e.code){case"KeyT":open("https://twitter.com/intent/tweet?text=viral%20marketing%20message%20https%3A%2F%2Fgoo.gl%2Fsome tiny Google url here","_blank");break;default:r=0,w=a}}});let ee=0,te=0,ie=0,ne=0;function oe(e){return[e.pageX||e.changedTouches[0].pageX,e.pageY||e.changedTouches[0].pageY]}i.ontouchstart=i.onpointerdown=(e=>{switch(e.preventDefault(),w){case s:[ie,ne]=[ee,te]=oe(e)}}),i.ontouchmove=i.onpointermove=(e=>{switch(e.preventDefault(),w){case s:ee&&te&&(([e,t])=>{e>ie?(ie=e)-ee>44&&(d.input.right=1):ee>e?ie-(ee=e)>44&&(d.input.left=-1):ie>e&&d.input.right?(ee=e,d.input.right=0):e>ee&&d.input.left&&(ie=e,d.input.left=0),t>ne?(ne=t)-te>44&&(d.input.down=1):te>t?ne-(te=t)>44&&(d.input.up=-1):ne>t&&d.input.down?(te=t,d.input.down=0):t>te&&d.input.up&&(ne=t,d.input.up=0)})(oe(e))}}),i.ontouchend=i.onpointerup=(e=>{switch(e.preventDefault(),w){case a:H();break;case s:d.input.left=d.input.right=d.input.up=d.input.down=0,ee=te=ie=ne=0;break;case l:r=0,w=a}})}();</script>
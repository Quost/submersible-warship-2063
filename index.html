<style>body{margin:0;text-align:center;background:#000;touch-action:none}canvas{image-rendering:-moz-crisp-edges;image-rendering:pixelated}</style><canvas id="c"></canvas><script>!function(){function e(e,t,n){return e>n?n:t>e?t:e}function t(e,t){return Math.floor(Math.random()*(t+1-e)+e)}function n(e){return e[t(0,e.length-1)]}const i=[38,38,40,40,37,39,37,39,66,65];let o=0;const r=0,a=1,s=2;let l,h,d,u,g,w=r,p=[],f=0;const y=180/Math.PI;function b(){this.left=0,this.right=0,this.up=0,this.down=0}function A(e,t){this.type=e,this.target=t,this.nextChange=.5,this.remaining=0}function m(e,t=0,n=0,i=0){this.speed=e,this.dx=t,this.dy=n,this.dr=i}function k(e,t,n=0){this.x=e,this.y=t,this.r=n}function v(e,t,n){this.collide=e,this.killable=t,this.foe=n}function x(e){this.timeLeft=e}function M(e,t,n,i){this.alwaysRender=e,this.renderer=t,this.radarRenderer=n,this.debrisRenderer=i}const P=c.getContext("2d"),S=c.cloneNode(),T=S.getContext("2d"),E=c.cloneNode(),C=E.getContext("2d"),I={},B=8;for(let e=0;43>e;e++)I["abcdefghijklmnopqrstuvwxyz0123456789.:!-%,/"[e]]=e*B;const D=0,R=1,F=2,U=.1;let W,K,H,L,O="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAVgAAAAIAgMAAADB+w+QAAAADFBMVEUAAAARCgP///8AAADe3w1AAAAAAXRSTlMAQObYZgAAAUlJREFUKM9VUjFuwzAMpAf5BVGB+jVeuquA6CFzUYDqZzzEQ3Z5ENr+sXeiE6MiJNFH8kTSFFXNMWtSrJhz1K7oTDgkTX2rL2L0CCkgApKp9+8kWDwvEUqU0rpUv836bWUuZjbVUvum5Vj0mIhCrEJf/Zu04yryYVBMEOBE23/afrZTHpS+mcbSbEfUrduayDCPa8zvbZiHJt1l6xSbaWkvtwgS0p4Zeij3tMOjFsQsrUC/wkvb9bcYcx3XqY4Vd2UTntlaI62xJWr3BxWwtvRaPu9ThdxAt1/3xatoQ7WvghwpsJJ8FQ/0bIuXeTxk3vOdBY/sIG5qHkFZdvoB+V6AU2Iub8NaZjlcGOIB1HH6L7M0EavIgLTQzweAMnfaflg6RcRex9lEcnwOWPIBi0lxHgMmAQDHLGjodh8o2oFm4Id4E8B3CZLlD7GmBBrI7F8nAAAAAElFTkSuQmCC",V=!0;function Z(){g=0,l=j("player",{collision:new v(!0,o!==i.length,!1),input:new b,position:new k(200,S.height-200),velocity:new m(40),sprite:new M(!0,N,ne,()=>_("rgb(75,190,250)"))}),d=[l],u=[j("sub1",{collision:new v(!0,!0,!0),input:new b,position:new k(100,100),velocity:new m(20),strategy:new A("random"),sprite:new M(!1,$,ie,()=>_("rgb(230,90,100)"))}),j("sub1",{collision:new v(!0,!0,!0),input:new b,position:new k(100,S.height-100),velocity:new m(20),strategy:new A("random"),sprite:new M(!1,$,ie,()=>_("rgb(230,90,100)"))}),j("sub1",{collision:new v(!0,!0,!0),input:new b,position:new k(S.width-100,100),velocity:new m(20),strategy:new A("random"),sprite:new M(!1,$,ie,()=>_("rgb(230,90,100)"))}),j("sub1",{collision:new v(!0,!0,!0),input:new b,position:new k(S.width-100,S.height-100),velocity:new m(20),strategy:new A("random"),sprite:new M(!1,$,ie,()=>_("rgb(230,90,100)"))})],h=[...d,...u],w=a}function j(e,t){return{...t,echo:{...t.position},online:!0,radius:6,type:e}}function z({x:e,y:t},{x:n,y:i},o){return Math.pow(o,2)>Math.pow(e-n,2)+Math.pow(t-i,2)}function Q(e){if(e.collision.killable){e.dead=!0,e!==l&&"torpedo"!==e.type&&f++;const{position:{x:n,y:i},velocity:{dx:o,dy:r,speed:a}}=e,s=new v(!1,!1),h=new M(!0,e.sprite.debrisRenderer);[1,2,3].forEach(e=>{const l=new k(n,i),c=new m(a,o/2+t(-2,2)/10,r/2+t(-2,2)/10,t(1,e+1)*(e%2?1:-1)),d=new x(t(20,50)/10);p.push(j("debris",{collision:s,position:l,sprite:h,ttl:d,velocity:c}))})}}function J({position:e,velocity:t},{echo:n}){return(({x:e,y:t},{x:n,y:i})=>((Math.atan2(i,n)-Math.atan2(t,e))*y+180)%360-180)({x:t.dx,y:t.dy},{x:n.x-e.x,y:n.y-e.y})}function X({r:e},t){return Math.sin(-e/y)*t}function Y({r:e},t){return Math.cos(-e/y)*t}function q({echo:e,sprite:t}){T.save(),T.translate(Math.round(e.x),Math.round(e.y)),T.rotate(e.r/y),t.renderer(),T.restore()}function N(){T.shadowBlur=10,T.fillStyle="rgb(75,190,250)",T.shadowColor=T.fillStyle,T.beginPath(),T.arc(0,0,5,0,2*Math.PI),T.fillRect(-2,-12,4,12),T.fill(),T.closePath()}function G(){T.shadowBlur=10,T.strokeStyle=l.online?"rgb(220,240,150)":"rgb(80,100,80)",T.lineWidth=3,T.shadowColor=T.strokeStyle,T.beginPath(),T.moveTo(0,-6),T.lineTo(0,2),T.stroke(),T.moveTo(0,4),T.lineTo(0,6),T.stroke(),T.closePath()}function $(){T.beginPath(),T.shadowBlur=10,T.fillStyle=l.online?"rgb(230,90,100)":"rgb(55,40,35)",T.shadowColor=T.fillStyle,T.fillRect(-5,-5,10,10),T.fillRect(-2,-12,4,12),T.fill(),T.closePath()}function _(e){T.beginPath(),T.shadowBlur=10,T.fillStyle=e,T.shadowColor=T.fillStyle,T.moveTo(-5,-10),T.lineTo(5,0),T.lineTo(-4,-2),T.fill(),T.closePath()}function ee(e){const{echo:t,sprite:n}=e;n.radarRenderer&&(T.save(),T.translate(Math.round(t.x),Math.round(t.y)),n.radarRenderer(e),T.restore())}function te({echo:e}){T.rotate(e.r/180*Math.PI),T.shadowBlur=10,T.strokeStyle=l.online?"rgb(220,240,150)":"rgb(80,100,80)",T.shadowColor=T.strokeStyle,T.fillStyle=l.online?"rgba(80,100,80,0.15)":"rgba(80,100,80,0.25)",T.beginPath(),T.moveTo(-4,0),T.arc(0,0,200,5*-Math.PI/8,3*-Math.PI/8),T.lineTo(4,0),T.fill(),T.stroke(),T.closePath()}function ne(e){const{dashOffset:t=0,dashTime:n=0}=e;T.shadowBlur=10,T.strokeStyle="rgb(70,105,105)",T.shadowColor=T.strokeStyle,T.beginPath(),T.arc(0,0,100,0,2*Math.PI),T.stroke(),T.closePath(),T.beginPath(),T.lineDashOffset=t,T.setLineDash([4,8]),T.arc(0,0,40,0,2*Math.PI),T.stroke(),T.closePath(),e.dashTime=n+K,e.dashTime>U&&(e.dashTime-=U,e.dashOffset=(t-1)%12)}function ie(){T.shadowBlur=10,T.strokeStyle="rgb(55,40,35)",T.shadowColor=T.strokeStyle,T.beginPath(),T.arc(0,0,80,0,2*Math.PI),T.stroke(),T.closePath()}function oe(e,t,n,i=D,o=1){const r=o*B,a=e.length*r,s=i===F?a:i===R?a/2:0;[...e].forEach((e,i)=>{e in I&&T.drawImage(O,I[e],0,B,B,t+i*r-s,n,r,r)})}function re(){V&&(L=requestAnimationFrame(re),(()=>{switch(T.fillStyle="rgb(20,35,40)",T.fillRect(0,0,S.width,S.height),w){case r:oe("submersible warship 2063",B,B),oe("press any key",S.width/2,S.height/2,R),o===i.length&&oe("konami mode on",S.width-B,B,F);break;case a:T.fillStyle=T.createPattern(E,"repeat"),T.fillRect(0,0,S.width,S.height),h.forEach(ee),h.forEach(q),oe(`sonar: ${l.online?"on":"off"}line`,B,B);break;case s:oe("game over",B,B),oe(`you ${u.length===u.filter(({dead:e})=>e).length?"won":"lost"}`,S.width/2,S.height/2,R)}P.drawImage(S,0,0,S.width,S.height,0,0,c.width,c.height)})(),W=Date.now(),K=(W-H)/1e3,(()=>{switch(w){case a:h.forEach(t=>{(e=>{const{strategy:t,position:n,collision:{foe:i}}=e;if(t)switch(t.type){case"lockon":const{echo:o,online:r,dead:a}=t.target;(a||!r&&z(n,o,10))&&(e.strategy={...t,type:"cruise",target:void 0,nextChange:.5,remaining:0},e.input=null,e.velocity.dr=0);break;case"cruise":h.filter(({collision:e})=>!!e.foe&&e.foe!==i).forEach(i=>{const{echo:o}=i;z(n,o,180)&&22.5>Math.abs(J(e,i))&&(e.strategy={...t,type:"lockon",target:i,nextChange:.1,remaining:0},t.target=i,e.input=new b)})}})(t),(e=>{const{input:t,strategy:i}=e;if(i&&(i.remaining-=K,0>i.remaining))switch(i.remaining+=i.nextChange,i.type){case"lockon":const o=J(e,i.target);t.left=-5>o?-1:0,t.right=o>5?1:0,t.up=-1,t.down=0;break;case"random":t.up=n([-1,0]),t.left=n([-1,0]),t.right=n([1,0]),t.down=n([1,0])}})(t),(({input:e,position:t,velocity:n})=>{e&&(n.dr=e.left+e.right,n.dx=X(t,e.up+e.down),n.dy=Y(t,e.up+e.down))})(t),(({velocity:e,position:t})=>{const n=e.speed*K;t.x+=n*e.dx,t.y+=n*e.dy,t.r=(t.r+n*e.dr)%360})(t),(({position:e,echo:t,sprite:n,online:i})=>{(n.alwaysRender||l.online&&i)&&(t.x=e.x,t.y=e.y,t.r=e.r)})(t),(e=>{let{ttl:t}=e;t&&(t.timeLeft-=K,1>t.timeLeft&&(e.dead=!0))})(t),(t=>{const{position:n}=t;n.x=e(n.x,0,S.width-t.radius),n.y=e(n.y,0,S.height-t.radius)})(t)});let t=new Set;h.forEach((e,n)=>{h.slice(n+1).forEach(n=>{((e,t)=>{const{position:n,collision:i}=e,{position:o,collision:r}=t;return i.collide&&r.collide&&z(n,o,e.radius+t.radius)})(e,n)&&(t.add(e),t.add(n))})}),t.forEach(Q),h=h.filter(({dead:e})=>!e),p.length>0&&(p.forEach(e=>h.push(e)),p=[]),d.length!==d.filter(({dead:e})=>e).length&&u.length!==u.filter(({dead:e})=>e).length||(g+=K),g>4&&(w=s)}})(),H=W)}function ae(e){(V=e)?(H=Date.now(),re()):cancelAnimationFrame(L)}onload=(async e=>{document.title="Submersible Warship 2063",onresize(),E.width=E.height=64,C.strokeStyle="rgb(40,55,50)",C.beginPath(),C.moveTo(0,4),C.lineTo(8,4),C.stroke(),C.closePath(),C.beginPath(),C.moveTo(4,0),C.lineTo(4,8),C.stroke(),C.closePath(),O=await(e=>new Promise(t=>{let n=new Image;n.onload=(()=>t(n)),n.src=e}))(O),ae(!0)}),onresize=onrotate=(()=>{c.width=S.width=innerWidth>1.6*innerHeight?1.6*innerHeight:innerWidth,c.height=S.height=innerWidth>1.6*innerHeight?innerHeight:innerWidth/1.6,P.imageSmoothingEnabled=T.imageSmoothingEnabled=!1}),document.onvisibilitychange=(e=>{ae(!e.target.hidden)}),onkeydown=(e=>{if(e.preventDefault(),!e.repeat)switch(w){case a:switch(e.code){case"ArrowLeft":case"KeyA":l.input.left=-1;break;case"ArrowUp":case"KeyW":l.input.up=-1;break;case"ArrowRight":case"KeyD":l.input.right=1;break;case"ArrowDown":case"KeyS":l.input.down=1;break;case"Space":l.dead||(({position:e},t)=>{const n=new A("cruise"),i=new v(!0,!0,!1),o=new M(!1,G,te,()=>_("rgb(220,240,150)")),r=new x(30),a=X(e,-1),s=Y(e,-1),l=new k(e.x+20*a,e.y+20*s,e.r),h=new m(60,a,s);p.push(j("torpedo",{collision:i,input:null,position:l,sprite:o,strategy:n,ttl:r,velocity:h}))})(l);break;case"KeyP":ae(!V)}}}),onkeyup=(e=>{switch(w){case r:e.which!==i[o]||o===i.length?Z():o++;break;case a:switch(e.code){case"ArrowLeft":case"KeyA":l.input.left=0;break;case"ArrowRight":case"KeyD":l.input.right=0;break;case"ArrowUp":case"KeyW":l.input.up=0;break;case"ArrowDown":case"KeyS":l.input.down=0;break;case"KeyO":case"KeyF":l.online=!l.online,l.switchModeTime=W}break;case s:switch(e.code){case"KeyT":open(`https://twitter.com/intent/tweet?text=I%20sunk%20${f||0}%20enemy%20submarines%20in%20Submersible%20Warship%202063%20by%20@herebefrogs%20for%20@js13kgames%202018%3A%20https%3A%2F%2Fgoo.gl%2FHLo6Df`,"_blank");break;default:o=0,w=r}}});let se=0,le=0,he=0,ce=0;function de(e){return[e.pageX||e.changedTouches[0].pageX,e.pageY||e.changedTouches[0].pageY]}ontouchstart=onpointerdown=(e=>{switch(e.preventDefault(),w){case a:[he,ce]=[se,le]=de(e)}}),ontouchmove=onpointermove=(e=>{switch(e.preventDefault(),w){case a:se&&le&&(([e,t])=>{e>he?(he=e)-se>44&&(l.input.right=1):se>e?he-(se=e)>44&&(l.input.left=-1):he>e&&l.input.right?(se=e,l.input.right=0):e>se&&l.input.left&&(he=e,l.input.left=0),t>ce?(ce=t)-le>44&&(l.input.down=1):le>t?ce-(le=t)>44&&(l.input.up=-1):ce>t&&l.input.down?(le=t,l.input.down=0):t>le&&l.input.up&&(ce=t,l.input.up=0)})(de(e))}}),ontouchend=onpointerup=(e=>{switch(e.preventDefault(),w){case r:Z();break;case a:l.input.left=l.input.right=l.input.up=l.input.down=0,se=le=he=ce=0;break;case s:o=0,w=r}})}();</script>